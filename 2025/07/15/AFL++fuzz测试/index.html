<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>AFL++fuzz测试 | Daily Study</title><meta name="author" content="C0KE"><meta name="copyright" content="C0KE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="AFL++fuzz测试概述AFL++是AFL的社区维护版本。它拥有更快的fuzzing速度，更好的变异策略、插桩性能和功能，以及支持各类自定义的模块。 AFL简介AFL（American Fuzzy Lop）是由安全研究员Micha? Zalewski（@lcamtuf）开发的一款基于覆盖引导（Coverage-guided）的模糊测试工具，它通过记录输入样本的代码覆盖率，从而调整输入样本以提高覆">
<meta property="og:type" content="article">
<meta property="og:title" content="AFL++fuzz测试">
<meta property="og:url" content="http://c0ke.top/2025/07/15/AFL++fuzz%E6%B5%8B%E8%AF%95/index.html">
<meta property="og:site_name" content="Daily Study">
<meta property="og:description" content="AFL++fuzz测试概述AFL++是AFL的社区维护版本。它拥有更快的fuzzing速度，更好的变异策略、插桩性能和功能，以及支持各类自定义的模块。 AFL简介AFL（American Fuzzy Lop）是由安全研究员Micha? Zalewski（@lcamtuf）开发的一款基于覆盖引导（Coverage-guided）的模糊测试工具，它通过记录输入样本的代码覆盖率，从而调整输入样本以提高覆">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png">
<meta property="article:published_time" content="2025-07-15T08:06:26.137Z">
<meta property="article:modified_time" content="2025-07-30T03:18:41.398Z">
<meta property="article:author" content="C0KE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png"><link rel="shortcut icon" href="/img/fa.jpg"><link rel="canonical" href="http://c0ke.top/2025/07/15/AFL++fuzz%E6%B5%8B%E8%AF%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AFL++fuzz测试',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-30 11:18:41'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">404</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Daily Study"><span class="site-name">Daily Study</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">AFL++fuzz测试</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-15T08:06:26.137Z" title="发表于 2025-07-15 16:06:26">2025-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-30T03:18:41.398Z" title="更新于 2025-07-30 11:18:41">2025-07-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="AFL++fuzz测试"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="AFL-fuzz测试"><a href="#AFL-fuzz测试" class="headerlink" title="AFL++fuzz测试"></a>AFL++fuzz测试</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>AFL++是AFL的社区维护版本。它拥有更快的fuzzing速度，更好的变异策略、插桩性能和功能，以及支持各类自定义的模块。</p>
<h2 id="AFL简介"><a href="#AFL简介" class="headerlink" title="AFL简介"></a>AFL简介</h2><p>AFL（American Fuzzy Lop）是由安全研究员Micha? Zalewski（<a target="_blank" rel="noopener" href="https://twitter.com/lcamtuf">@lcamtuf</a>）开发的一款基于覆盖引导（Coverage-guided）的模糊测试工具，它通过记录输入样本的代码覆盖率，从而调整输入样本以提高覆盖率，增加发现漏洞的概率。</p>
<p>①从源码编译程序时进行插桩，以记录代码覆盖率（Code Coverage）；<br>②选择一些输入文件，作为初始测试集加入输入队列（queue）；<br>③将队列中的文件按一定的策略进行“突变”；<br>④如果经过变异文件更新了覆盖范围，则将其保留添加到队列中;<br>⑤上述过程会一直循环进行，期间触发了crash的文件会被记录下来。</p>
<h2 id="选择和评估测试的目标"><a href="#选择和评估测试的目标" class="headerlink" title="选择和评估测试的目标"></a>选择和评估测试的目标</h2><p>开始Fuzzing前，首先要选择一个目标。 AFL的目标通常是接受外部输入的程序或库，输入一般来自文件（后面的文章也会介绍如何Fuzzing一个网络程序）。</p>
<h3 id="1-用什么语言编写"><a href="#1-用什么语言编写" class="headerlink" title="1. 用什么语言编写"></a>1. 用什么语言编写</h3><p>AFL主要用于C&#x2F;C++程序的测试，所以这是我们寻找软件的最优先规则。（也有一些基于AFL的JAVA Fuzz程序如<a target="_blank" rel="noopener" href="https://github.com/isstac/kelinci">kelinci</a>、<a target="_blank" rel="noopener" href="https://github.com/Barro/java-afl">java-afl</a>等，但并不知道效果如何）</p>
<h3 id="2-是否开源"><a href="#2-是否开源" class="headerlink" title="2. 是否开源"></a>2. 是否开源</h3><p>AFL既可以对源码进行编译时插桩，也可以使用AFL的<code>QEMU mode</code>对二进制文件进行插桩，但是前者的效率相对来说要高很多，在Github上很容易就能找到很多合适的项目。</p>
<h3 id="3-程序版本"><a href="#3-程序版本" class="headerlink" title="3. 程序版本"></a>3. 程序版本</h3><p>目标应该是该软件的最新版本，不然辛辛苦苦找到一个漏洞，却发现早就被上报修复了就尴尬了。</p>
<h3 id="4-是否有示例程序、测试用例"><a href="#4-是否有示例程序、测试用例" class="headerlink" title="4. 是否有示例程序、测试用例"></a>4. 是否有示例程序、测试用例</h3><p>如果目标有现成的基本代码示例，特别是一些开源的库，可以方便我们调用该库不用自己再写一个程序；如果目标存在测试用例，那后面构建语料库时也省事儿一点。</p>
<h3 id="5-项目规模"><a href="#5-项目规模" class="headerlink" title="5.项目规模"></a>5.项目规模</h3><p>某些程序规模很大，会被分为好几个模块，为了提高Fuzz效率，在Fuzzing前，需要定义Fuzzing部分。这里推荐一下源码阅读工具Understand，它<code>treemap</code>功能，可以直观地看到项目结构和规模。比如下面ImageMagick的源码中，灰框代表一个文件夹，蓝色方块代表了一个文件，其大小和颜色分别反映了行数和文件复杂度。</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282157000-006tNbRwgy1fxopbcxjbnj31fk0u07wl.jpeg" alt="img"></p>
<h3 id="6-程序曾出现过漏洞"><a href="#6-程序曾出现过漏洞" class="headerlink" title="6. 程序曾出现过漏洞"></a>6. 程序曾出现过漏洞</h3><p>如果某个程序曾曝出过多次漏洞，那么该程序有仍有很大可能存在未被发现的安全漏洞。如<a target="_blank" rel="noopener" href="https://github.com/ImageMagick/ImageMagick">ImageMagick</a>每个月都会发现难以利用的新漏洞，并且每年都会发生一些具有高影响的严重漏洞。</p>
<h2 id="构建语料库"><a href="#构建语料库" class="headerlink" title="构建语料库"></a>构建语料库</h2><p>AFL需要一些初始输入数据（也叫种子文件）作为Fuzzing的起点，这些输入甚至可以是毫无意义的数据，AFL可以通过启发式算法自动确定文件格式结构。lcamtuf就在博客中给出了一个有趣的<a target="_blank" rel="noopener" href="https://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html">例子</a>——对djpeg进行Fuzzing时，仅用一个字符串”hello”作为输入，最后凭空生成大量jpge图像！</p>
<p>尽管AFL如此强大，但如果要获得更快的Fuzzing速度，那么就有必要生成一个高质量的语料库，这一节就解决如何选择输入文件、从哪里寻找这些文件、如何精简找到的文件三个问题。</p>
<h4 id="1-选择"><a href="#1-选择" class="headerlink" title="1. 选择"></a>1. 选择</h4><h5 id="1-有效的输入"><a href="#1-有效的输入" class="headerlink" title="(1) 有效的输入"></a>(1) 有效的输入</h5><p>尽管有时候无效输入会产生bug和崩溃，但有效输入可以更快的找到更多执行路径。</p>
<h5 id="2-尽量小的体积"><a href="#2-尽量小的体积" class="headerlink" title="(2) 尽量小的体积"></a>(2) 尽量小的体积</h5><p>较小的文件会不仅可以减少测试和处理的时间，也能节约更多的内存，AFL给出的建议是最好小于1 KB，但其实可以根据自己测试的程序权衡，这在AFL文档的<code>perf_tips.txt</code>中有具体说明。</p>
<h4 id="2-寻找"><a href="#2-寻找" class="headerlink" title="2. 寻找"></a>2. 寻找</h4><ol>
<li>使用项目自身提供的测试用例</li>
<li>目标程序bug提交页面</li>
<li>使用格式转换器，用从现有的文件格式生成一些不容易找到的文件格式：</li>
<li>afl源码的testcases目录下提供了一些测试用例</li>
<li>其他大型的语料库</li>
<li><a target="_blank" rel="noopener" href="http://lcamtuf.coredump.cx/afl/demo/">afl generated image test sets</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/google/fuzzer-test-suite">fuzzer-test-suite</a></li>
<li><a target="_blank" rel="noopener" href="https://samples.libav.org/">libav samples</a></li>
<li><a target="_blank" rel="noopener" href="http://samples.ffmpeg.org/">ffmpeg samples</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/MozillaSecurity/fuzzdata">fuzzdata</a></li>
<li><a target="_blank" rel="noopener" href="https://gitlab.anu.edu.au/lunar/moonshine">moonshine</a></li>
</ol>
<h4 id="3-修剪"><a href="#3-修剪" class="headerlink" title="3. 修剪"></a>3. 修剪</h4><p>网上找到的一些大型语料库中往往包含大量的文件，这时就需要对其精简，这个工作有个术语叫做——语料库蒸馏（Corpus Distillation）。AFL提供了两个工具来帮助我们完成这部工作——<code>afl-cmin</code>和<code>afl-tmin</code>。</p>
<h5 id="1-移除执行相同代码的输入文件——AFL-CMIN"><a href="#1-移除执行相同代码的输入文件——AFL-CMIN" class="headerlink" title="(1) 移除执行相同代码的输入文件——AFL-CMIN"></a>(1) 移除执行相同代码的输入文件——AFL-CMIN</h5><p><code>afl-cmin</code>的核心思想是：<strong>尝试找到与语料库全集具有相同覆盖范围的最小子集</strong>。举个例子：假设有多个文件，都覆盖了相同的代码，那么就丢掉多余的文件。其使用方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params]</span><br></pre></td></tr></table></figure>

<p>更多的时候，我们需要从文件中获取输入，这时可以使用“@@”代替被测试程序命令行中输入文件名的位置。Fuzzer会将其替换为实际执行的文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$ afl-cmin -i input_dir -o output_dir -- /path/to/tested/program [params] @@</span><br></pre></td></tr></table></figure>

<p>下面的例子中，我们将一个有1253个png文件的语料库，精简到只包含60个文件。</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282158000-006tNbRwgy1fxvwad4ksuj30r40ckwie.jpeg" alt="img"></p>
<h5 id="2-减小单个输入文件的大小——AFL-TMIN"><a href="#2-减小单个输入文件的大小——AFL-TMIN" class="headerlink" title="(2) 减小单个输入文件的大小——AFL-TMIN"></a>(2) 减小单个输入文件的大小——AFL-TMIN</h5><p>整体的大小得到了改善，接下来还要对每个文件进行更细化的处理。afl-tmin缩减文件体积的原理这里就不深究了，有机会会在后面文章中解释，这里只给出使用方法（其实也很简单，有兴趣的朋友可以自己搜一搜）。</p>
<p><code>afl-tmin</code>有两种工作模式，<code>instrumented mode</code>和<code>crash mode</code>。默认的工作方式是<code>instrumented mode</code>，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ afl-tmin -i input_file -o output_file -- /path/to/tested/program [params] @@ </span><br></pre></td></tr></table></figure>

<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282158000-006tNbRwgy1fxvxx5b6wgj30yt0u04iv.jpeg" alt="img"></p>
<p>如果指定了参数<code>-x</code>，即<code>crash mode</code>，会把导致程序非正常退出的文件直接剔除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ afl-tmin -x -i input_file -o output_file -- /path/to/tested/program [params] @@</span><br></pre></td></tr></table></figure>

<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282158000-006tNbRwgy1fxvz0mrvmwj30zq0nagxn.jpeg" alt="img"></p>
<p><code>afl-tmin</code>接受单个文件输入，所以可以用一条简单的shell脚本批量处理。如果语料库中文件数量特别多，且体积特别大的情况下，这个过程可能花费几天甚至更长的时间！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in *; do afl-tmin -i $i -o tmin-$i -- ~/path/to/tested/program [params] @@; done; </span><br></pre></td></tr></table></figure>

<p>下图是经过两种模式的修剪后，语料库大小的变化：</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282158000-006tNbRwgy1fxvz8cs2wqj30pk056myl.jpeg" alt="img"></p>
<p>这时还可以再次使用<code>afl-cmin</code>，发现又可以过滤掉一些文件了。</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/1552282158000-006tNbRwgy1fxvy1ryqo7j30rc0ciwif.jpeg" alt="img"></p>
<h2 id="搭建AFL-环境"><a href="#搭建AFL-环境" class="headerlink" title="搭建AFL++环境"></a>搭建AFL++环境</h2><h3 id="搭建实验环境"><a href="#搭建实验环境" class="headerlink" title="搭建实验环境"></a>搭建实验环境</h3><h4 id="获取-编译AFL"><a href="#获取-编译AFL" class="headerlink" title="获取 &amp; 编译AFL++"></a>获取 &amp; 编译AFL++</h4><p>本节仅用于在 ubuntu&#x2F;debian 环境下自行配置AFL++环境</p>
<blockquote>
<p>编译方式也可见官网文档 <a href="https://gitee.com/link?target=https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/INSTALL.md">https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/INSTALL.md</a></p>
</blockquote>
<ol>
<li>获取AFL++</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载AFLplusplus源代码</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/AFLplusplus/AFLplusplus.git --depth 1</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装 llvm 和 clang。</li>
</ol>
<blockquote>
<p>AFL++在llvm模式下使用afl-clang-fast具有更多的特性。</p>
</blockquote>
<p>运行如下命令，安装llvm、clang和相关依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 11, 12 版本可能会出现一些问题</span></span><br><span class="line"><span class="comment"># https://github.com/llvm/llvm-project/issues/55785</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y llvm-13 clang-13 llvm-13-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖包</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y build-essential python3-dev flex bison libglib2.0-dev libpixman-1-dev python3-setuptools</span><br></pre></td></tr></table></figure>

<p>将llvm-config指向已经安装版本：:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果是自行安装的其他llvm版本，此处需要对应修改命令末尾的llvm-config-xx为本地的版本</span></span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/llvm-config llvm-config /usr/bin/llvm-config-13 13</span><br></pre></td></tr></table></figure>

<p>可以测试如下命令，如果有版本号输出，则配置完成:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llvm-config --version</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编译AFL++</li>
</ol>
<p>进入第一步下载AFLplusplus的源代码目录<code>cd AFLplusplus</code>, 而后运行如下编译命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译可能需要一些时间，建议拉高虚拟机的内存</span></span><br><span class="line">make afl-fuzz</span><br><span class="line">make afl-showmap</span><br><span class="line">make llvm</span><br></pre></td></tr></table></figure>

<p>在AFLplusplus目录中存在<code>afl-fuzz</code>以及<code>afl-cc</code>说明基础的编译已经完成；存在<code>afl-clang-fast</code>说明llvm模式下的AFL++编译已经完成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> | grep <span class="string">&quot;afl-&quot;</span></span><br><span class="line">afl-cc <span class="comment"># &lt;-</span></span><br><span class="line">...</span><br><span class="line">afl-clang-fast <span class="comment"># &lt;-</span></span><br><span class="line">...</span><br><span class="line">afl-fuzz</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此外，还可以运行<code>sudo make install</code>,将编译后的二进制复制到PATH能查找到的位置，此时就不用再执行接下来的第四步配置了。</p>
</blockquote>
<ol start="4">
<li>将<code>afl-fuzz</code>、<code>afl-clang-fast</code>等加入PATH中,方便后续使用：</li>
</ol>
<p>对于自行配置的环境，如果当前使用的默认shell是bash，则将下一行的命令添加到<code>~/.bashrc</code>文件的其他位置，如果使用的是zsh，则添加到<code>~/.zshrc</code>文件中的任意位置。</p>
<blockquote>
<p>注意修改命令中<code>/path/to/AFLplusplus</code>目录的位置为绝对路径</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/path/to/AFLplusplus:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>完成配置后，在新的终端测试<code>afl-fuzz</code>命令，会有如下类似的输出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ afl-fuzz</span><br><span class="line">afl-fuzz++4.06c based on afl by Michal Zalewski and a large online community</span><br><span class="line"></span><br><span class="line">afl-fuzz [ options ] -- /path/to/fuzzed_app [ ... ]</span><br><span class="line"></span><br><span class="line">Required parameters:</span><br><span class="line">  -i <span class="built_in">dir</span>        - input directory with <span class="built_in">test</span> cases</span><br><span class="line">  -o <span class="built_in">dir</span>        - output directory <span class="keyword">for</span> fuzzer findings</span><br><span class="line"></span><br><span class="line">Execution control settings:</span><br><span class="line">  -p schedule   - power schedules compute a seed<span class="string">&#x27;s performance score:</span></span><br><span class="line"><span class="string">                  fast(default), explore, exploit, seek, rare, mmopt, coe, lin</span></span><br><span class="line"><span class="string">                  quad -- see docs/FAQ.md for more information</span></span><br><span class="line"><span class="string">  -f file       - location read by the fuzzed program (default: stdin or @@)</span></span><br><span class="line"><span class="string">  -t msec       - timeout for each run (auto-scaled, default 1000 ms). Add a &#x27;</span>+<span class="string">&#x27;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>

<h4 id="编译带有AddressSanitizer的libxml2"><a href="#编译带有AddressSanitizer的libxml2" class="headerlink" title="编译带有AddressSanitizer的libxml2"></a>编译带有AddressSanitizer的libxml2</h4><p>这里的libxml2可以改为其他源码</p>
<ol>
<li>获取libxml2的源代码</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fetch libxml2 source code</span></span><br><span class="line">wget http://xmlsoft.org/download/libxml2-2.9.4.tar.gz</span><br><span class="line">tar -xf libxml2-2.9.4.tar.gz</span><br></pre></td></tr></table></figure>

<ol>
<li>编译libxml2</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> libxml2-2.9.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># install dependency</span></span><br><span class="line"><span class="built_in">sudo</span> apt install automake</span><br><span class="line"></span><br><span class="line"><span class="comment"># config it</span></span><br><span class="line">CC=afl-clang-fast CXX=afl-clang-fast++ ./configure --with-debug --disable-shared -without-ftp --without-http --without-legacy --without-python</span><br><span class="line"></span><br><span class="line"><span class="comment"># build it</span></span><br><span class="line">AFL_USE_ASAN=1 make -j `<span class="built_in">nproc</span>`</span><br></pre></td></tr></table></figure>

<ol>
<li>编译完成后，运行如下命令，如果有类似<code>T __asan_report_error</code>的输出，则表示编译出的xmllint二进制文件已经带有ASan的插桩。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm xmllint | grep __asan_report_error</span><br></pre></td></tr></table></figure>

<h3 id="Fuzzing-libxml2"><a href="#Fuzzing-libxml2" class="headerlink" title="Fuzzing libxml2"></a>Fuzzing libxml2</h3><ol>
<li>创建一个工作目录 <code>mkdir work</code></li>
<li>为了提高fuzz xml的效率，我们可以使用AFL++预设的xml dictionary:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/AFLplusplus/AFLplusplus/stable/dictionaries/xml.dict</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果下载失败，也可以使用 <a target="_blank" rel="noopener" href="https://gitee.com/ret2happy/ssec22_fuzzing_script/raw/master/xml.dict">https://gitee.com/ret2happy/ssec22_fuzzing_script/raw/master/xml.dict</a></p>
</blockquote>
<ol start="3">
<li>创建初始语料库（可以寻找更好的xml初始种子，此处仅提供样例）</li>
</ol>
<blockquote>
<p>tips: 可以在libxml2源代码中的测试样例中找到更好的测试语料。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/ret2happy/libxml2_sample.git corpus</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>创建一个主fuzzer进行fuzz:</li>
</ol>
<p>配置运行前的系统:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&quot;echo core &gt;/proc/sys/kernel/core_pattern&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建主fuzzer:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -M master -m none -x xml.dict -i /path/to/corpus -o output -- /path/to/xmllint --valid @@</span><br></pre></td></tr></table></figure>

<p>其中</p>
<ul>
<li><code>-M master</code>表示将当前fuzzer尽可能的被指定为master fuzzer。master fuzzer会对各个slave fuzzer进行语料的管理与调度。</li>
<li><code>-m none</code>ASan开启时需要大量虚拟内存，此处让fuzzer不对内存进行限制。</li>
<li><code>-x xml.dict</code>指向之前获取的xml.dict，用于提供变异时的候选词。</li>
<li><code>-i /path/to/corpus</code>指定了初始的输入语料库</li>
<li><code>-o output</code>指定fuzzer的输出目录，其中包含了已变异待执行的testcase，fuzzer目前的状态、寻找到的crash等各类信息。</li>
<li><code>xmllint --valid @@</code>指定了被fuzz程序的命令执行方式，其中<code>@@</code>表示占位的文件名，在运行时AFL会将输入文件的文件名替换<code>@@</code>，以便被测程序能够读取真实的输入。</li>
</ul>
<blockquote>
<p>tips: 对于master fuzzer，我们可以不使用<code>-D</code>的参数，而通过仅在slave fuzzer中加入<code>-D</code>参数以增加各个fuzzer策略的多样性。这对于寻找crash有很大帮助。</p>
</blockquote>
<p>运行后的效果如图所示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> american fuzzy lop ++4.07c &#123;slave1&#125; (../libxml2-2.9.4/xmllint) [fast]</span><br><span class="line">┌─ process timing ────────────────────────────────────┬─ overall results ────┐</span><br><span class="line">│        run time : 0 days, 0 hrs, 27 min, 47 sec     │  cycles <span class="keyword">done</span> : 0     │</span><br><span class="line">│   last new find : 0 days, 0 hrs, 0 min, 23 sec      │ corpus count : 1965  │</span><br><span class="line">│last saved crash : none seen yet                     │saved crashes : 0     │</span><br><span class="line">│ last saved hang : none seen yet                     │  saved hangs : 0     │</span><br><span class="line">├─ cycle progress ─────────────────────┬─ map coverage┴──────────────────────┤</span><br><span class="line">│  now processing : 912.1 (46.4%)      │    map density : 1.66% / 7.89%      │</span><br><span class="line">│  runs timed out : 0 (0.00%)          │ count coverage : 2.56 bits/tuple    │</span><br><span class="line">├─ stage progress ─────────────────────┼─ findings <span class="keyword">in</span> depth ─────────────────┤</span><br><span class="line">│  now trying : user extras (over)     │ favored items : 545 (27.74%)        │</span><br><span class="line">│ stage execs : 2172/9000 (24.13%)     │  new edges on : 797 (40.56%)        │</span><br><span class="line">│ total execs : 1.34M                  │ total crashes : 0 (0 saved)         │</span><br><span class="line">│  <span class="built_in">exec</span> speed : 870.1/sec              │  total tmouts : 3 (0 saved)         │</span><br><span class="line">├─ fuzzing strategy yields ────────────┴─────────────┬─ item geometry ───────┤</span><br><span class="line">│   bit flips : 277/21.3k, 69/21.3k, 37/21.2k        │    levels : 5         │</span><br><span class="line">│  byte flips : 1/2665, 14/2632, 12/2568             │   pending : 1931      │</span><br><span class="line">│ arithmetics : 137/148k, 2/8133, 0/729              │  pend fav : 534       │</span><br><span class="line">│  known ints : 23/15.0k, 24/72.7k, 18/112k          │ own finds : 1962      │</span><br><span class="line">│  dictionary : 211/140k, 108/152k, 4/11.2k, 1/11.9k │  imported : 0         │</span><br><span class="line">│havoc/splice : 910/564k, 114/12.6k                  │ stability : 99.91%    │</span><br><span class="line">│py/custom/rq : unused, unused, unused, unused       ├───────────────────────┘</span><br><span class="line">│    trim/eff : 9.16%/1079, 0.00%                    │          [cpu000: 25%]</span><br><span class="line">└────────────────────────────────────────────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>创建更多的fuzzer:</li>
</ol>
<p>运行第一个slave fuzzer：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -S slave1 -D -m none -x xml.dict -i /path/to/corpus -o output -- /path/to/xmllint --valid @@</span><br></pre></td></tr></table></figure>

<p>其中，将<code>-M master</code>改成了<code>-S slave1</code>。<code>-S</code>表示当前fuzzer为slave fuzzer，仍然会进行独立的fuzzing，而<code>slave1</code>的名字可以自定义，作为该fuzzer的名字，各个slave fuzzer之间的名字不能重复。<br>由此我们可以创建多个fuzzer，充分利用多核进行fuzzing。此外，加入了<code>-D</code>参数启用deterministic fuzzing。</p>
<p>进行一段时间的fuzzing后，AFL++将发现若干crash，如图所示，可以看到在<code>total crashes</code>(红字处)显示发现了数个crash:</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/b3477f26_5739219.png" alt="输入图片说明"></p>
<h3 id="重现寻找到的crash"><a href="#重现寻找到的crash" class="headerlink" title="重现寻找到的crash:"></a>重现寻找到的crash:</h3><p>在上述AFL++发现crash后，我们进入output输出目录，在对应的fuzzer文件夹(文件夹名为对应的fuzzer名字)内的<code>crashes</code>文件夹内可以找到fuzzer保存的用于复现的testcase (<code>README.txt</code>包含了找到该crash所用的fuzzer命令行参数):</p>
<p><img src="/picture/AFL++fuzz%E6%B5%8B%E8%AF%95/ac0dff93_5739219.png" alt="输入图片说明"></p>
<p>我们可以利用其中的testcase，复现模糊测试得到的内存破坏:</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://c0ke.top">C0KE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://c0ke.top/2025/07/15/AFL++fuzz%E6%B5%8B%E8%AF%95/">http://c0ke.top/2025/07/15/AFL++fuzz%E6%B5%8B%E8%AF%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://c0ke.top" target="_blank">Daily Study</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/15/AFL++fuzz%E6%B5%8B%E8%AF%95%E8%B7%AF%E7%94%B1%E5%99%A8%E5%9B%BA%E4%BB%B6/" title="AFL++fuzz测试路由器固件"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">AFL++fuzz测试路由器固件</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/15/8080%E6%B1%87%E7%BC%96%E6%89%8B%E5%86%8C%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%8C%87%E4%BB%A4/" title="8080汇编手册数据传输指令"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">8080汇编手册数据传输指令</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">C0KE</div><div class="author-info__description">C0KE's Study Diary</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">404</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/C0KE"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/C0KE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/weixin_62675330?spm=1000.2115.3001.5343" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="mailto:2269279877@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人人都有选择如何活着的权力</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AFL-fuzz%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">AFL++fuzz测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AFL%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">AFL简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%92%8C%E8%AF%84%E4%BC%B0%E6%B5%8B%E8%AF%95%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="toc-number">1.3.</span> <span class="toc-text">选择和评估测试的目标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%A8%E4%BB%80%E4%B9%88%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. 用什么语言编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%98%AF%E5%90%A6%E5%BC%80%E6%BA%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. 是否开源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%A8%8B%E5%BA%8F%E7%89%88%E6%9C%AC"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. 程序版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%98%AF%E5%90%A6%E6%9C%89%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">4. 是否有示例程序、测试用例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%A1%B9%E7%9B%AE%E8%A7%84%E6%A8%A1"><span class="toc-number">1.3.5.</span> <span class="toc-text">5.项目规模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%A8%8B%E5%BA%8F%E6%9B%BE%E5%87%BA%E7%8E%B0%E8%BF%87%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.3.6.</span> <span class="toc-text">6. 程序曾出现过漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%AF%AD%E6%96%99%E5%BA%93"><span class="toc-number">1.4.</span> <span class="toc-text">构建语料库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%80%89%E6%8B%A9"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">1. 选择</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%9C%89%E6%95%88%E7%9A%84%E8%BE%93%E5%85%A5"><span class="toc-number">1.4.0.1.1.</span> <span class="toc-text">(1) 有效的输入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B0%BD%E9%87%8F%E5%B0%8F%E7%9A%84%E4%BD%93%E7%A7%AF"><span class="toc-number">1.4.0.1.2.</span> <span class="toc-text">(2) 尽量小的体积</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AF%BB%E6%89%BE"><span class="toc-number">1.4.0.2.</span> <span class="toc-text">2. 寻找</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E5%89%AA"><span class="toc-number">1.4.0.3.</span> <span class="toc-text">3. 修剪</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A7%BB%E9%99%A4%E6%89%A7%E8%A1%8C%E7%9B%B8%E5%90%8C%E4%BB%A3%E7%A0%81%E7%9A%84%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6%E2%80%94%E2%80%94AFL-CMIN"><span class="toc-number">1.4.0.3.1.</span> <span class="toc-text">(1) 移除执行相同代码的输入文件——AFL-CMIN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%87%8F%E5%B0%8F%E5%8D%95%E4%B8%AA%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%A7%E5%B0%8F%E2%80%94%E2%80%94AFL-TMIN"><span class="toc-number">1.4.0.3.2.</span> <span class="toc-text">(2) 减小单个输入文件的大小——AFL-TMIN</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAAFL-%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.</span> <span class="toc-text">搭建AFL++环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.1.</span> <span class="toc-text">搭建实验环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-%E7%BC%96%E8%AF%91AFL"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">获取 &amp; 编译AFL++</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%B8%A6%E6%9C%89AddressSanitizer%E7%9A%84libxml2"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">编译带有AddressSanitizer的libxml2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fuzzing-libxml2"><span class="toc-number">1.5.2.</span> <span class="toc-text">Fuzzing libxml2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%8E%B0%E5%AF%BB%E6%89%BE%E5%88%B0%E7%9A%84crash"><span class="toc-number">1.5.3.</span> <span class="toc-text">重现寻找到的crash:</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/Tenda-FH1201%E5%A4%9A%E5%A4%84%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0/" title="Tenda-FH1201多处命令注入漏洞分析和复现"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Tenda-FH1201多处命令注入漏洞分析和复现"/></a><div class="content"><a class="title" href="/2025/07/30/Tenda-FH1201%E5%A4%9A%E5%A4%84%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0/" title="Tenda-FH1201多处命令注入漏洞分析和复现">Tenda-FH1201多处命令注入漏洞分析和复现</a><time datetime="2025-07-30T03:04:06.916Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/GL-iNet%20%E8%B7%AF%E7%94%B1%E5%99%A8%20CVE-2024-39226%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="GL-iNet 路由器 CVE-2024-39226 漏洞分析"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GL-iNet 路由器 CVE-2024-39226 漏洞分析"/></a><div class="content"><a class="title" href="/2025/07/30/GL-iNet%20%E8%B7%AF%E7%94%B1%E5%99%A8%20CVE-2024-39226%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="GL-iNet 路由器 CVE-2024-39226 漏洞分析">GL-iNet 路由器 CVE-2024-39226 漏洞分析</a><time datetime="2025-07-30T03:04:06.914Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/%E5%90%AF%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E7%8E%AF%E5%A2%83/" title="启动路由器环境"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="启动路由器环境"/></a><div class="content"><a class="title" href="/2025/07/30/%E5%90%AF%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E7%8E%AF%E5%A2%83/" title="启动路由器环境">启动路由器环境</a><time datetime="2025-07-30T03:04:06.907Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/%E4%BF%AE%E5%A4%8D%E8%B7%AF%E7%94%B1%E5%99%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83+%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/" title="修复路由器程序运行环境+远程调试"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="修复路由器程序运行环境+远程调试"/></a><div class="content"><a class="title" href="/2025/07/30/%E4%BF%AE%E5%A4%8D%E8%B7%AF%E7%94%B1%E5%99%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83+%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/" title="修复路由器程序运行环境+远程调试">修复路由器程序运行环境+远程调试</a><time datetime="2025-07-30T03:04:06.906Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/ikuai-3.7.10%E7%89%88%E6%9C%AC%E4%BB%A5%E4%B8%8B%E6%9C%89%E6%8E%88%E6%9D%83%E7%9A%84cmd%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/" title="ikuai-3.7.10版本以下有授权的cmd执行复现"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ikuai-3.7.10版本以下有授权的cmd执行复现"/></a><div class="content"><a class="title" href="/2025/07/30/ikuai-3.7.10%E7%89%88%E6%9C%AC%E4%BB%A5%E4%B8%8B%E6%9C%89%E6%8E%88%E6%9D%83%E7%9A%84cmd%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/" title="ikuai-3.7.10版本以下有授权的cmd执行复现">ikuai-3.7.10版本以下有授权的cmd执行复现</a><time datetime="2025-07-30T03:04:06.904Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By C0KE</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="C0KE,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>