<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>YARA &amp; Suricata 入侵检测规则 | Daily Study</title><meta name="author" content="C0KE"><meta name="copyright" content="C0KE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="YARA &amp; Suricata 入侵检测规则YARA规则Yara 简介yara是一个用于帮助恶意软件研究人员识别和分类恶意软件样本的开源工具，其每条描述、规则都由一系列字符串和一个布尔类型表达式构成，并用于阐述其逻辑。其可以用于对于文件进行匹配，进而来判断是否出现在已经进行过规则描述的某恶意软件。 IDA的Find Cryptos插件也运用到了yara规则来进行匹配对应密码学相关特征数据字">
<meta property="og:type" content="article">
<meta property="og:title" content="YARA &amp; Suricata 入侵检测规则">
<meta property="og:url" content="http://c0ke.top/2025/07/15/YARA%20&%20Suricata%20%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%A7%84%E5%88%99/index.html">
<meta property="og:site_name" content="Daily Study">
<meta property="og:description" content="YARA &amp; Suricata 入侵检测规则YARA规则Yara 简介yara是一个用于帮助恶意软件研究人员识别和分类恶意软件样本的开源工具，其每条描述、规则都由一系列字符串和一个布尔类型表达式构成，并用于阐述其逻辑。其可以用于对于文件进行匹配，进而来判断是否出现在已经进行过规则描述的某恶意软件。 IDA的Find Cryptos插件也运用到了yara规则来进行匹配对应密码学相关特征数据字">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png">
<meta property="article:published_time" content="2025-07-15T08:06:26.382Z">
<meta property="article:modified_time" content="2025-07-30T06:16:42.665Z">
<meta property="article:author" content="C0KE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png"><link rel="shortcut icon" href="/img/fa.jpg"><link rel="canonical" href="http://c0ke.top/2025/07/15/YARA%20&amp;%20Suricata%20%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%A7%84%E5%88%99/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'YARA & Suricata 入侵检测规则',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-30 14:16:42'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">404</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Daily Study"><span class="site-name">Daily Study</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">YARA &amp; Suricata 入侵检测规则</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-15T08:06:26.382Z" title="发表于 2025-07-15 16:06:26">2025-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-30T06:16:42.665Z" title="更新于 2025-07-30 14:16:42">2025-07-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/APT%E6%94%BB%E5%87%BB%E5%88%86%E6%9E%90/">APT攻击分析</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="YARA &amp; Suricata 入侵检测规则"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="YARA-Suricata-入侵检测规则"><a href="#YARA-Suricata-入侵检测规则" class="headerlink" title="YARA &amp; Suricata 入侵检测规则"></a>YARA &amp; Suricata 入侵检测规则</h1><h2 id="YARA规则"><a href="#YARA规则" class="headerlink" title="YARA规则"></a>YARA规则</h2><h3 id="Yara-简介"><a href="#Yara-简介" class="headerlink" title="Yara 简介"></a>Yara 简介</h3><p><code>yara</code>是一个用于帮助恶意软件研究人员识别和分类恶意软件样本的开源工具，其每条描述、规则都由一系列字符串和一个布尔类型表达式构成，并用于阐述其逻辑。其可以用于对于文件进行匹配，进而来判断是否出现在已经进行过规则描述的某恶意软件。</p>
<p><code>IDA</code>的<code>Find Cryptos</code>插件也运用到了<code>yara</code>规则来进行匹配对应密码学相关特征数据字段，通过对固定密码盒的识别来尝试性提醒用户存在对应的加密规则。对于<code>yara</code>可能更多的像是一种正则表达式来对目标数据进行匹配。</p>
<blockquote>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/VirusTotal/yara%EF%BC%8C%EF%BC%88yara64.exe">https://github.com/VirusTotal/yara，（yara64.exe</a> ， yarac64.exe ）</p>
<p>python：<a target="_blank" rel="noopener" href="https://github.com/VirusTotal/yara-python">https://github.com/VirusTotal/yara-python</a></p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://yara.readthedocs.io/">https://yara.readthedocs.io/</a></p>
</blockquote>
<h3 id="Yara-规则编写"><a href="#Yara-规则编写" class="headerlink" title="Yara 规则编写"></a>Yara 规则编写</h3><p>从官方文档来看<code>yara</code>的开头必须为<code>rule</code>，随后跟着一个定义名，其命名规则同样遵循与<code>C 语言</code>类似的规则，可以包含任意字母数字或是下划线，但是需要注意的是第一个字符不能够是数字。与此同时，<code>yara</code>中有一些预定义的关键字，命名不能够与其相同</p>
<p><img src="/picutre/WNFcAskVuTvfzKg.png" alt="image-20231010231609126"></p>
<p>下面我们举出一个编写的例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rule ExampleRule</span><br><span class="line">&#123;</span><br><span class="line">	meta:</span><br><span class="line">		description = &quot;This is just an example&quot;</span><br><span class="line">		thread_level = 3</span><br><span class="line">		in_the_wild = true</span><br><span class="line">	strings:</span><br><span class="line">		$my_text_string = &quot;text here&quot;</span><br><span class="line">		$my_hex_string = &#123; E2 34 A1 C8 23 FB &#125;</span><br><span class="line">	condition:</span><br><span class="line">		$my_text_string or $my_hex_string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>meta</code>描述的是规则信息，我们可以添加作者信息，威胁等级，在野情况，文件MD5之类的信息，<code>string</code>则是规则字段，中间我们可以插入一些关键的判断字段如一些<code>HEX</code>值或是恶意<code>URL</code>，<code>condition</code>字段则是对应我们的条件判断部分，通过对应的布尔运算进行连接。</p>
<blockquote>
<p>需要注意的是对应的变量需要以<code>$</code>开头，代表其为一个变量，而在我们的<code>meta</code>描述信息中则不需要（因为其不是变量）</p>
</blockquote>
<h4 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h4><h5 id="HEX"><a href="#HEX" class="headerlink" title="HEX"></a>HEX</h5><p>在我们之前的例子中有一个<code>HEX String</code>，在其中我们可以使用正则表达式进行进行通用匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$hex_string = &#123; E2 34 ?? C8 A? FB &#125;</span><br><span class="line">$hex_string = &#123; F4 23 8[4-6] 62 B4 &#125;</span><br></pre></td></tr></table></figure>

<p>在<code>yara2.0</code>之后可以使用无界跳转</p>
<blockquote>
<p>一般的正则表达式是线性匹配，一旦开始便是从头开始逐步匹配，直到到达模式的结尾。但是无界跳转可以让我们在代码的执行中的任意位置进行跳转，而不仅仅限于按顺序执行。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$hex_string = &#123; FE 39 45 [10-] 89 00 &#125;</span><br><span class="line">$hex_string = &#123; FE 39 45 [-] 89 00 &#125;</span><br></pre></td></tr></table></figure>

<p>在上述中<code>[10-]</code>可以匹配<code>11 12 13 14 ...</code>多个16进制串，同理<code>[-]</code>可以匹配<code>00 01 02 ...</code></p>
<p>或者我们可以给定有一部分的替换方案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$hex_string = &#123; F4 23 ( 62 B4 | 56 ) 45 &#125;</span><br></pre></td></tr></table></figure>

<p>他会匹配：<code>F42362B445</code>或是<code>F4235645</code></p>
<h5 id="Text-strings"><a href="#Text-strings" class="headerlink" title="Text strings"></a>Text strings</h5><p>当我们需要对字符串进行匹配时我们有以下关键字来帮助我们进一步细化</p>
<p><strong>不区分大小写： nocase</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$text_string = &quot;abc&quot; nocase</span><br></pre></td></tr></table></figure>

<p><strong>宽字节：wide</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$text_string = &quot;abc&quot; wide</span><br></pre></td></tr></table></figure>

<p>相当于我们在匹配<code>Unicode</code>字符串</p>
<p>如果我们要同时搜索<code>ASCII</code>以及宽字节格式的字符串，我们可以将<code>ascii</code>修饰符与<code>wide</code>结合使用，使用顺序无所谓</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$wide_and_ascii_string = &quot;abc&quot; ascii wide</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般情况下的text都是ascii的</p>
</blockquote>
<p><strong>异或：xor</strong></p>
<p>当我们的一个字符串可能发生各种异或时我们对其添加修饰符<code>xor</code>便可以匹配对应单字节在不同情况下的异或值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$xor_string = &quot;This program cannot&quot; xor</span><br></pre></td></tr></table></figure>

<p>其则可以匹配下面类似的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$xor_string_01 = &quot;Uihr!qsnfs`l!b`oonu&quot;</span><br><span class="line">$xor_string_02 = &quot;Vjkq\&quot;rpmepco\&quot;acllmv&quot;</span><br></pre></td></tr></table></figure>

<p>同样的我们可以结合修饰符<code>wide</code>和<code>ascii</code>使用</p>
<p><strong>Base64编码：base64</strong></p>
<p>对于一个可能被编码为<code>base64</code>的字符串，我们可以使用关键字<code>base64</code>来对其进行进行匹配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$xor_string = &quot;This program cannot&quot; base64</span><br></pre></td></tr></table></figure>

<p>对应的可以匹配类似下面的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VGhpcyBwcm9ncmFtIGNhbm5vd [A-Za-z0-9-_]</span><br></pre></td></tr></table></figure>

<p>对于上面结果我们也可以使用<code>wide</code>来将编码后的结果转换为宽字节匹配</p>
<p>上述的<code>base64</code>编码我们也可以自定义码表，其长度必须为 64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a = &quot;This program cannot&quot; base64(&quot;!@#$%^&amp;*()&#123;&#125;[].,|ABCDEFGHIJ\x09LMNOPQRSTUVWXYZabcdefghijklmnopqrstu&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>全字匹配：fullword</strong></p>
<p>比如我们在对域名进行匹配时，我们对<code>domain</code>添加了<code>fullword</code>修饰符，那么<code>www.mydomain.com</code>不会被匹配，但是<code>www.my-domain.com and www.domain.com</code>这样会被匹配</p>
<h5 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h5><p>如果我们对于某内容需要进行正则匹配时我们需要带上两个斜线如：<code>/xxx/</code>，其中<code>xxx</code>为我们的内容，对于正则语法则和常规的差不多</p>
<p>其对应可以匹配的元字符：</p>
<table>
<thead>
<tr>
<th>\</th>
<th>引用下一个元字符</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td><strong>匹配文件的开头，或在用作左括号后的第一个字符时，对字符类求反</strong></td>
</tr>
<tr>
<td>$</td>
<td><strong>匹配文件的结尾</strong></td>
</tr>
<tr>
<td>.</td>
<td><strong>匹配除换行符以外的任何单个字符</strong></td>
</tr>
<tr>
<td>&#96;</td>
<td><strong>用于对正则表达式进行定界</strong></td>
</tr>
<tr>
<td>()</td>
<td><strong>Grouping</strong></td>
</tr>
<tr>
<td>[]</td>
<td><strong>Bracketed character class</strong></td>
</tr>
</tbody></table>
<p>以下量词也可以识别：</p>
<table>
<thead>
<tr>
<th>*</th>
<th>Match 0 or more times</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td><strong>Match 1 or more times</strong></td>
</tr>
<tr>
<td>?</td>
<td><strong>Match 0 or 1 times</strong></td>
</tr>
<tr>
<td>{n}</td>
<td><strong>Match exactly n times（精确匹配）</strong></td>
</tr>
<tr>
<td>{n,}</td>
<td><strong>Match at least n times（至少匹配n次）</strong></td>
</tr>
<tr>
<td>{,m}</td>
<td><strong>Match at most m times（最多匹配n次）</strong></td>
</tr>
<tr>
<td>{n,m}</td>
<td><strong>Match n to m times</strong></td>
</tr>
</tbody></table>
<p>以下转义字符可识别：</p>
<table>
<thead>
<tr>
<th>\t</th>
<th><strong>Tab (HT, TAB)</strong></th>
</tr>
</thead>
<tbody><tr>
<td>\n</td>
<td><strong>New line (LF, NL)</strong></td>
</tr>
<tr>
<td>\r</td>
<td><strong>Return (CR)</strong></td>
</tr>
<tr>
<td>\f</td>
<td><strong>Form feed (FF)换页</strong></td>
</tr>
<tr>
<td>\a</td>
<td><strong>Alarm bell</strong></td>
</tr>
<tr>
<td>\xNN</td>
<td><strong>序号为给定十六进制数的字符</strong></td>
</tr>
</tbody></table>
<p>公认字符类：</p>
<table>
<thead>
<tr>
<th>\w</th>
<th>匹配单词字符 (alphanumeric plus “_”)</th>
</tr>
</thead>
<tbody><tr>
<td>\W</td>
<td>匹配非单词字符</td>
</tr>
<tr>
<td>\s</td>
<td>匹配空白字符</td>
</tr>
<tr>
<td>\S</td>
<td>Match a non-whitespace character</td>
</tr>
<tr>
<td>\d</td>
<td>匹配十进制数字字符</td>
</tr>
<tr>
<td>\D</td>
<td>Match a non-digit character</td>
</tr>
</tbody></table>
<h4 id="Conditions"><a href="#Conditions" class="headerlink" title="Conditions"></a>Conditions</h4><p><code>conditions</code>即布尔表达式，<code>and</code>、<code>or</code>、<code>not</code>，关运算符，算数运算符，位运算等。</p>
<p>需要注意的是整数的长度始终为 64 位，在使用位运算符是需要注意</p>
<blockquote>
<p>如 ~0x01 不是 0xFE 而是 0xFFFFFFFFFE</p>
</blockquote>
<h5 id="Counting-strings"><a href="#Counting-strings" class="headerlink" title="Counting strings"></a>Counting strings</h5><p>假如我们需要对一个字符串进行计数，我们使用的则是井号来计数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rule CountExample</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        #a == 6 and #b &gt; 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>yara 4.2.0后我们可以使用 in 来判断某个区间是否出现了指定个数的字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#a in (filesize-500..filesize) == 2</span><br><span class="line">// 文件最后500个字节中的 a 所代表的字符串数必须正好等于2。</span><br></pre></td></tr></table></figure>

<h5 id="String-offset-or-Virtual-address"><a href="#String-offset-or-Virtual-address" class="headerlink" title="String offset or Virtual address"></a>String offset or Virtual address</h5><p>当我们需要判断对应的字符串是否在指定的偏移时，我们可以使用关键字<code>at</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rule AtExample</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $a at 100 and $b at 200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>at</code>运算符允许在文件或进程内存空间中的虚拟地址的某个固定偏移量处搜索字符串，而<code>in</code>运算符允许在偏移量或地址范围内搜索字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rule InExample</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $a in (0..100) and $b in (100..filesize)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与此同时我们可以使用<code>@a[i]</code>获得字符串<code>$a</code>第 i 次出现的偏移量或虚拟地址</p>
<p>其中索引是基于1的，因此第一次出现是<code>@a[1]</code>，第二次出现是<code>@a[2]</code>，依此类推。如果提供的索引大于字符串的出现次数，则结果将是一个<code>NaN</code>（不是数字）值</p>
<h5 id="File-Size"><a href="#File-Size" class="headerlink" title="File Size"></a>File Size</h5><p>我们判断文件大小时可以直接使用关键字<code>filesize</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rule FileSizeExample&#123;</span><br><span class="line">	condition:</span><br><span class="line">		filesize &gt; 100kb</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Executable-entry-point"><a href="#Executable-entry-point" class="headerlink" title="Executable entry point"></a>Executable entry point</h5><p>对于一个<code>PE</code>文件我们可以使用<code>entrypoint</code>关键字来对目标的入口点进行判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">rule EntryPointExample1</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &#123; E8 00 00 00 00 &#125;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $a at entrypoint</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule EntryPointExample2</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &#123; 9C 50 66 A1 ?? ?? ?? 00 66 A9 ?? ?? 58 0F 85 &#125;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $a in (entrypoint..entrypoint + 10)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="对于偏移处数据的访问判断"><a href="#对于偏移处数据的访问判断" class="headerlink" title="对于偏移处数据的访问判断"></a>对于偏移处数据的访问判断</h5><p>对于这种类型判断我们需要使用<code>int8</code>、<code>int16</code>、<code>int32</code>…等关键字，其中指明的内容为对应的文件偏移或者是对应的虚拟地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rule IsPE</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        // MZ signature at offset 0 and ...</span><br><span class="line">        uint16(0) == 0x5A4D and</span><br><span class="line">        // ... PE signature at offset stored in MZ header at 0x3C</span><br><span class="line">        uint32(uint32(0x3C)) == 0x00004550</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="字符串集"><a href="#字符串集" class="headerlink" title="字符串集"></a>字符串集</h5><p>我们可以使用<code>of</code>关键字来表示至少存在字符串集中的一部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rule OfExample1</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line">        $c = &quot;dummy3&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        2 of ($a,$b,$c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当出现几个名字有着相同构成的变量名我们同样可以使用正则表达式对其进行选中，对于字符串需要全选中时我们可以使用<code>($*)</code>来进行匹配或是使用<code>them</code>关键字来表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rule OfExample4</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line">        $c = &quot;dummy3&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        1 of them // equivalent to 1 of ($*)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有以下几种方式进行表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">all of them       // all strings in the rule</span><br><span class="line">any of them       // any string in the rule</span><br><span class="line">all of ($a*)      // all strings whose identifier starts by $a</span><br><span class="line">any of ($a,$b,$c) // any of $a, $b or $c</span><br><span class="line">1 of ($*)         // same that &quot;any of them&quot;</span><br><span class="line">none of ($b*)     // zero of the set of strings that start with &quot;$b&quot;</span><br></pre></td></tr></table></figure>

<h5 id="对多个字符串应用相同的条件"><a href="#对多个字符串应用相同的条件" class="headerlink" title="对多个字符串应用相同的条件"></a>对多个字符串应用相同的条件</h5><p>当我们需要对多个字符串使用相同的条件的时候，我们可以使用<code>for..of</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for expression of string_set : (boolean_expression)</span><br></pre></td></tr></table></figure>

<p>对于字符串我们可以使用<code>$</code>来做占位符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for any of ($a,$b,$c) : ( $ at pe.entry_point  )</span><br><span class="line">// $a、$b、$c中有一个在 PE 文件的入口点 </span><br></pre></td></tr></table></figure>

<p>在yara 4.0后<code>for..of</code>得到了改善</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for any section in pe.sections : ( section.name == &quot;.text&quot; )</span><br><span class="line">//等价</span><br><span class="line">for any i in (0..pe.number_of_sections-1) : ( pe.sections[i].name == &quot;.text&quot; )</span><br></pre></td></tr></table></figure>

<h5 id="迭代字符串出现的次数"><a href="#迭代字符串出现的次数" class="headerlink" title="迭代字符串出现的次数"></a>迭代字符串出现的次数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rule Occurrences</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">        $a = &quot;dummy1&quot;</span><br><span class="line">        $b = &quot;dummy2&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        for all i in (1,2,3) : ( @a[i] + 10 == @b[i] )</span><br><span class="line">    	//也可以这样写</span><br><span class="line">    	// for all i in (1..3) : ( @a[i] + 10 == @b[i] )</span><br><span class="line">    	// a 前 3 次出现的位置 +10 得到 b 前 3 次出现的位置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="More-rules"><a href="#More-rules" class="headerlink" title="More rules"></a>More rules</h4><h5 id="Global-rules"><a href="#Global-rules" class="headerlink" title="Global rules"></a>Global rules</h5><p>我们可以添加一些全局的规则，这些规则会在所有规则中添加限制。全局规则可以有多个，我们只需要在原先的<code>rule</code>前加一个<code>global</code>即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">global rule SizeLimit</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        filesize &lt; 2MB</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h5><p>我们可以在<code>meta</code>中添加一些<code>tag</code>，当我们在导出结果时可以对其更好的组织管理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rule Example</span><br><span class="line">&#123;</span><br><span class="line">    meta:</span><br><span class="line">        description = &quot;This is an example rule&quot;</span><br><span class="line">        author = &quot;John Doe&quot;</span><br><span class="line">        tags = &quot;malware, trojan&quot;</span><br><span class="line"></span><br><span class="line">    strings:</span><br><span class="line">        $str = &quot;Hello World&quot;</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Other-Modules"><a href="#Other-Modules" class="headerlink" title="Other Modules"></a>Other Modules</h4><h5 id="PE"><a href="#PE" class="headerlink" title="PE"></a>PE</h5><blockquote>
<p><a target="_blank" rel="noopener" href="https://yara.readthedocs.io/en/v4.4.0/modules/pe.html">PE module — yara 4.4.0 documentation</a></p>
</blockquote>
<p>其可以通过导入<code>pe</code>来完成PE文件的相关判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &quot;pe&quot;</span><br></pre></td></tr></table></figure>

<p>其中包含许多方法，我们就简单的举几个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import &quot;pe&quot;</span><br><span class="line"></span><br><span class="line">rule single_section</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        pe.number_of_sections == 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule control_panel_applet</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        pe.exports(&quot;CPlApplet&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule is_dll</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        pe.characteristics &amp; pe.DLL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule is_pe</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        pe.is_pe</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h5><p>相似的对于<code>elf</code>我们也有同样的方法来对其进行分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &quot;elf&quot;</span><br><span class="line"></span><br><span class="line">rule single_section</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        elf.number_of_sections == 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule elf_64</span><br><span class="line">&#123;</span><br><span class="line">    condition:</span><br><span class="line">        elf.machine == elf.EM_X86_64</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h5><p>常见的<code>hash</code>加密在<code>yara</code>中也有对应的支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hash.md5(0, filesize) == &quot;feba6c919e3797e7778e8f2e85fa033d&quot; // md5(offset, size)</span><br><span class="line">hash.md5(&quot;dummy&quot;) == &quot;275876e34cf609db118f3d84b799a790&quot;</span><br></pre></td></tr></table></figure>



<h2 id="Suricata规则"><a href="#Suricata规则" class="headerlink" title="Suricata规则"></a>Suricata规则</h2><h3 id="suricata简介"><a href="#suricata简介" class="headerlink" title="suricata简介"></a>suricata简介</h3><p>Suricata是一款高性能的开源入侵检测系统（IDS）和入侵防御系统（IPS），它专门设计用于监测和保护计算机网络免受各种网络攻击。</p>
<h3 id="特点和功能："><a href="#特点和功能：" class="headerlink" title="特点和功能："></a>特点和功能：</h3><ol>
<li><strong>多线程支持：</strong> Suricata是一种多线程应用程序，能够有效利用多核处理器，提供高性能的网络流量分析和处理。</li>
<li><strong>规则引擎：</strong> Suricata使用规则引擎来检测网络流量中的恶意行为。规则可以根据特定的网络流量模式、签名、协议等来定义。</li>
<li><strong>协议支持：</strong> Suricata支持多种网络协议，包括但不限于TCP、UDP、ICMP、HTTP、FTP等，使其能够检测各种不同类型的网络攻击。</li>
<li><strong>文件MD5检测：</strong> Suricata可以检测文件的MD5哈希值，从而识别已知的恶意文件。</li>
<li><strong>TLS&#x2F;SSL解密：</strong> Suricata能够进行TLS&#x2F;SSL解密，使其能够检测加密流量中的潜在威胁。</li>
<li><strong>流量日志：</strong> Suricata能够生成详细的流量日志，帮助安全管理员了解网络中的活动，同时用于事后分析和调查。</li>
<li><strong>IPv6支持：</strong> Suricata具有对IPv6的完整支持，使其能够监控和防御IPv6网络。</li>
</ol>
<h3 id="suricata安装"><a href="#suricata安装" class="headerlink" title="suricata安装"></a>suricata安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:oisf/suricata-stable</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install suricata</span><br></pre></td></tr></table></figure>

<p>或者GCC编译安装，参考如下<a target="_blank" rel="noopener" href="https://docs.suricata.io/en/suricata-6.0.10/install.html">https://docs.suricata.io/en/suricata-6.0.10/install.html</a></p>
<h3 id="规则的构成"><a href="#规则的构成" class="headerlink" title="规则的构成"></a>规则的构成</h3><p>Suricata规则包含以下几个部分：</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>规则匹配后所执行的操作。常用的有drop、alert、reject等。</th>
<th>drop用于ips模式<br/>alert用于ids&#x2F;ips模式<br/>reject用于ips模式</th>
</tr>
</thead>
<tbody><tr>
<td>Protocol</td>
<td>规则所匹配的协议。常用的有TCP、UDP、ICMP等。</td>
<td>协议识别引擎通过特征端口&#x2F;特征字符决定流量协议类型</td>
</tr>
<tr>
<td>Source IP&#x2F;Port</td>
<td>规则所匹配的源IP地址和端口号。</td>
<td></td>
</tr>
<tr>
<td>Destination IP&#x2F;Port</td>
<td>规则所匹配的源IP地址和端口号。</td>
<td></td>
</tr>
<tr>
<td>Direction</td>
<td>规则所匹配的数据流方向，通常有inbound和outbound两种。</td>
<td>通过&lt;&gt;-符号筛选需要检测的流量</td>
</tr>
<tr>
<td>Options</td>
<td>规则匹配所需的选项。常用的有content、flow、metadata等。</td>
<td>根据各种关键字组合决定动作触发条件</td>
</tr>
</tbody></table>
<p>其中，content是最重要的选项之一，它用于匹配数据包的负载。Flow用于匹配数据包的流量方向，metadata用于提供额外的信息，比如协议版本等。除此之外，还有一些其他的选项，比如pcre、threshold、classtype等，它们可以帮助Suricata更加准确地匹配网络流量并进行分析。</p>
<h3 id="示例规则分析1"><a href="#示例规则分析1" class="headerlink" title="示例规则分析1"></a>示例规则分析1</h3><p>sid:2100498：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert ip <span class="keyword">any</span> <span class="keyword">any</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">any</span> <span class="keyword">any</span> (msg:&quot;GPL ATTACK_RESPONSE id check returned root&quot;; content:&quot;uid=0|28|root|29|&quot;;</span><br></pre></td></tr></table></figure>

<p>签名的alert部分是ACTION，ip any -&gt; any any部分是HEADER，签名的其余部分从（msg:GPL ATTACK_RESPONSE…）开始包含了规则的OPTIONS。</p>
<h4 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h4><ul>
<li><code>sid:2100498</code>签名的第一部分是Actions，在这里是alert。Suricata签名的Actions部分指定了<strong>当数据包符合规则时要采取的动作</strong>。根据Suricata是在IDS还是IPS模式下运行，行动还可以是以下之一：<ul>
<li><strong>Pass</strong> - Suricata将停止扫描该数据包，并允许其通过，但不产生警报。</li>
<li><strong>Drop</strong> - 当在IPS模式下工作时，Suricata将立即停止处理该数据包并产生警报。如果产生数据包的连接使用的是TCP，则会超时。</li>
<li><strong>Reject</strong> - 当Suricata运行IPS模式时，将发送一个TCP重置包，Suricata将放弃匹配的数据包。</li>
<li><strong>Alert</strong> - Suricata将生成一个警报，并将其记录下来以便进一步分析。</li>
</ul>
</li>
</ul>
<h4 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h4><p>每个Suricata签名都有一个Headers部分，<strong>描述了网络协议、源和目的IP地址、端口和流量方向</strong>。参考示例 <code>sid:2100498</code> 签名，该规则的头部分是突出显示的<code>ip any any -&gt; any any</code> 部分：</p>
<p>alert <strong>ip any any -&gt; any any</strong> (msg:”GPL ATTACK_RESPONSE id check returned root”; content:”uid&#x3D;0|28|root|29|”; classtype:bad-unknown; sid:2100498; rev:7; metadata:created_at 2010_09_23, updated_at 2010_09_23;)</p>
<p>一条规则的标题部分的一般格式是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PROTOCOL</span>&gt;</span> <span class="tag">&lt;<span class="name">SOURCE</span> <span class="attr">IP</span>&gt;</span> <span class="tag">&lt;<span class="name">SOURCE</span> <span class="attr">PORT</span>&gt;</span> -&gt; <span class="tag">&lt;<span class="name">DESTINATION</span> <span class="attr">IP</span>&gt;</span> <span class="tag">&lt;<span class="name">DESTINATION</span> <span class="attr">PORT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>PROTOCOL协议可以是以下之一：</p>
<ul>
<li>TCP</li>
<li>UDP</li>
<li>ICMP</li>
<li>IP</li>
<li>其他一些应用协议</li>
</ul>
<p>来源和目的地字段可以是IP地址或网络范围，或者是特殊值any，它将匹配所有的IP地址和网络。</p>
<p>箭头-&gt;表示流量的方向。</p>
<blockquote>
<p>注意：签名也可以使用非方向性标记&lt;&gt;，它将匹配两个方向的流量。然而，Suricata关于方向性标记的文档指出，大多数规则将使用-&gt;右侧的匹配箭头。</p>
</blockquote>
<p>如果你想<strong>对恶意的出站流量（即离开你的网络的流量）发出警报</strong>，那么源字段将是你的系统的IP地址或网络范围。目的地可以是一个远程系统的IP或网络，或特殊的任何值。</p>
<p>反过来说，如果你想<strong>对传入的恶意流量产生警报</strong>，源字段可以设置为任何，而目的地可以是你系统的IP地址或网络范围。</p>
<p>你还可以使用端口字段指定要检查的TCP或UDP端口。一般来说，来自一个系统的流量会被分配一个随机的端口，所以任何值对-&gt;指标的左边是合适的。如果你打算检查每个传入数据包的内容，目标端口也可以是任何，或者你可以限制一个签名，只扫描个别端口的数据包，如22用于SSH流量，或443用于HTTPS。</p>
<p>sid:2100498的<code>ip any -&gt; any any</code>头是一个通用的头，<strong>将匹配所有的流量</strong>，无论协议、源或目标IP或端口。当你想确保入站和出站流量被检查出可疑的内容时，这种捕获所有的头是有用的。</p>
<p>请注意，源、目的和端口字段也可以使用特殊的 ！否定操作符，它将处理与该字段值不匹配的流量。</p>
<p>例如，以下签名将使Suricata对所有来自任何网络的SSH数据包发出警报，这些数据包的目的地是你的网络（由203.0.113.0&#x2F;24 IP块代表），而不是以22端口为目的地：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert ssh any any -&gt; <span class="number">203.0</span><span class="number">.113</span><span class="number">.0</span>/<span class="number">24</span> !<span class="number">22</span> (sid:<span class="number">1000000</span>;)</span><br></pre></td></tr></table></figure>

<p>这种警报并不那么有用，因为它不包含任何关于数据包的信息，也不包含分类类型。为了给警报添加额外的信息，以及根据更具体的标准进行匹配，Suricata规则有一个OPTIONS部分，你可以为一个签名指定一些额外的设置。</p>
<h4 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h4><p>在Suricata签名中的括号（…）内的参数包含各种选项和关键字修改器，你可以用它们来匹配数据包的特定部分，对规则进行分类，或记录自定义信息。规则的header参数是针对IP、端口和协议级别的数据包标题，而OPTIONS则是<strong>针对数据包中的数据进行匹配</strong>。</p>
<p>Suricata规则中的OPTIONS必须用分号隔开，并且通常使用key:value格式。有些选项没有任何设置，只需要在规则中指定名称。</p>
<p>使用上一节的签名示例，你可以添加<strong>msg</strong>选项（即触发规则后返回的提示信息），其值为在<strong>非SSH端口检测到的SSH流量</strong>，解释警报的内容：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert ssh any any -&gt; <span class="number">203.0</span><span class="number">.113</span><span class="number">.0</span>/<span class="number">24</span> !<span class="number">22</span> (msg:<span class="string">&quot;SSH TRAFFIC on non-SSH port&quot;</span>; sid:<span class="number">1000000</span>;)</span><br></pre></td></tr></table></figure>

<p>关于如何在Suricata规则中使用每个选项的完整解释，从第6.2节开始的Suricata规则文档详细描述了每个关键词选项。</p>
<h5 id="关键字：Content"><a href="#关键字：Content" class="headerlink" title="关键字：Content"></a>关键字：<code>Content</code></h5><p>任何规则最重要的选项之一是<strong>Content内容关键词</strong>。回顾一下sid:2100498签名的例子：</p>
<p>alert ip any any -&gt; any any (msg:”GPL ATTACK_RESPONSE id check returned root”; <strong>content:”uid&#x3D;0|28|root|29|”;</strong> classtype:bad-unknown; sid:2100498; rev:7; metadata:created_at 2010_09_23, updated_at 2010_09_23;)</p>
<p>突出显示的内容: <code>&quot;uid=0|28|root|29|&quot;;</code>部分包含Content关键字，以及Suricata将在数据包内寻找的值。在这个签名示例中，来自任何端口的任何IP地址的所有数据包都将被检查，**以确保它们不包含字符串值uid&#x3D;0|28|root|29|**（在以前的教程中，它被用作表示被攻击的主机的例子）</p>
<p>Content关键字可以与Suricata中的大多数其他关键字一起使用。你可以使用头文件的组合来创建非常具体的签名，以及针对特定应用协议的选项，然后使用正则表达式检查数据包内容的单个字节、字符串或匹配。</p>
<p>例如，下面的签名检查DNS流量，寻找任何内容为your_domain.com的数据包，并生成一个警报：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert dns any any -&gt; any any (msg:<span class="string">&quot;DNS LOOKUP for your_domain.com&quot;</span>; dns<span class="selector-class">.query</span>; <span class="attribute">content</span>:<span class="string">&quot;your_domain.com&quot;</span>; sid:<span class="number">1000001</span>;)</span><br></pre></td></tr></table></figure>

<p>然而，如果DNS查询使用域名YOUR_DOMAIN.COM，则此规则将无法匹配，因为Suricata默认为大小写内容匹配。要使内容匹配对大小写不敏感，请在规则中添加<code>nocase;</code>关键字。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert dns any any -&gt; any any (msg:<span class="string">&quot;DNS LOOKUP for your_domain.com&quot;</span>; dns<span class="selector-class">.query</span>; <span class="attribute">content</span>:<span class="string">&quot;your_domain.com&quot;</span>; nocase; sid:<span class="number">1000001</span>;)</span><br></pre></td></tr></table></figure>

<p>现在，小写或大写字母的任何组合仍将与内容关键词相匹配。</p>
<h5 id="关键字msg"><a href="#关键字msg" class="headerlink" title="关键字msg"></a>关键字<code>msg</code></h5><p>本教程中的签名示例都包含了带有签名信息的msg关键字。虽然msg选项不是必须的，但留空的话，在检查Suricata的日志时，就很难理解为什么会发生警报或删除动作。</p>
<p>msg选项的设计是对一个警报的可读文本描述。它应该是描述性的，并为警报添加上下文，以便您或其他正在分析日志的人理解为什么警报被触发。在本教程的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/DAYceng/p/%E5%8F%82%E8%80%83%E5%85%B3%E9%94%AE%E8%AF%8D">reference Keyword</a>部分，你将了解到参考选项，你可以用它来链接到关于签名和它所要检测的问题的更多信息。</p>
<h5 id="关键字-sid-和-rev"><a href="#关键字-sid-和-rev" class="headerlink" title="关键字 sid 和 rev"></a>关键字<code> sid</code> 和 <code>rev</code></h5><p>每个Suricata签名都需要一个唯一的签名ID（sid）。<strong>如果两个规则具有相同的sid</strong>（在下面的输出示例中是sid:10000000），<strong>Suricata将不会启动</strong>，而会产生一个类似下面的错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example Duplicate sid Error. . .</span><br><span class="line">19/11/2021 -- 01:17:40 - &lt;Error&gt; - [ERRCODE: SC_ERR_DUPLICATE_SIG(176)] - Duplicate signature <span class="string">&quot;drop ssh any any -&gt; 127.0.0.0/8 !22 (msg:&quot;</span>blocked invalid ssh<span class="string">&quot;; sid:10000000;)&quot;</span></span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>当你创建自己的签名时，1000000-1999999的范围被保留给自定义规则。Suricata的内置规则的范围是2200000-2299999。其他边框范围在新出现的威胁SID分配页面上有记录。</p>
<p>sid选项通常是Suricata规则的最后部分。然而，如果一个签名有多个版本，并随着时间的推移而变化，则有一个rev选项，用于指定规则的版本。例如，本教程早期的SSH警报可以改为只扫描2022端口的SSH流量：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert ssh any any -&gt; <span class="number">203.0</span>.<span class="number">113.0</span>/<span class="number">24</span> <span class="number">2022</span> (msg:<span class="string">&quot;SSH TRAFFIC on non-SSH port&quot;</span>; sid:<span class="number">1000000</span>; rev:<span class="number">2</span>;)</span><br></pre></td></tr></table></figure>

<p>更新后的签名现在包括rev:2选项，表明它已经从以前的版本更新。</p>
<h5 id="关键字reference"><a href="#关键字reference" class="headerlink" title="关键字reference"></a>关键字<code>reference</code></h5><p>reference参考关键词在签名中用来描述在哪里可以找到更多关于规则所要检测的攻击或问题的信息。例如，如果一个签名是为了检测一种新的漏洞或攻击方法，参考字段可以用来链接到一个安全研究员或公司的网站，记录这个问题。</p>
<p><a target="_blank" rel="noopener" href="https://heartbleed.com/">OpenSSL中的Heartbleed漏洞</a>就是一个被广泛宣传和研究的漏洞的例子。Suricata带有签名，旨在检查不正确的TLS数据包，并包括对<a target="_blank" rel="noopener" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160">Heartbleed CVE主条目</a>的参考：</p>
<p>alert tls any any -&gt; any any (msg:”SURICATA TLS invalid heartbeat encountered, possible exploit attempt (heartbleed)”; flow:established; app-layer-event:tls.invalid_heartbeat_message; flowint:tls.anomaly.count,+,1; classtype:protocol-command-decode; <strong>reference:cve,2014-0160;</strong> sid:2230013; rev:1;)</p>
<p>请注意签名中突出显示的参考：<code>cve,2014-0160;</code> 部分。这个参考选项告诉您或正在检查Suricata警报的分析师，在哪里可以找到有关该特定问题的更多信息。</p>
<p>参考选项可以使用<code>/etc/suricata/reference.config</code>文件中的任何前缀。例如，在前面的例子中，可以用<strong>url</strong>来代替<strong>cve</strong>，用一个直接指向Heartbleed网站的链接来代替2014-0160 CVE标识。</p>
<h5 id="关键字classtype"><a href="#关键字classtype" class="headerlink" title="关键字classtype"></a>关键字<code>classtype</code></h5><p>Suricata可以根据一套预先配置好的类别对流量进行分类，这些类别在你用Linux发行版的软件包管理器安装Suricata软件包时就已经包含了。默认的分类文件通常在<code>/etc/suricata/classification.config</code>中找到，包含如下条目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># config classification:shortname,short description,priority</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">config classification: not-suspicious,Not Suspicious Traffic,3</span><br><span class="line">config classification: unknown,Unknown Traffic,3</span><br><span class="line">config classification: bad-unknown,Potentially Bad Traffic, 2</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>如文件头所示，每个分类条目有三个字段：</p>
<ul>
<li><strong>shortname</strong>：一个简短的、机器可读的名字，在上面的例子中分别是：not-suspicious、unknown和bad-unknown</li>
<li><strong>short description</strong>：用于警报的分类描述，例如：Not Suspicious Traffic</li>
<li><strong>priority</strong>：一个优先级字段，它决定了签名将被Suricata处理的顺序。最高的优先级是值1。当Suricata处理一个数据包时，使用更高优先级的分类器的签名将被首先检查。</li>
</ul>
<p>在 <code>sid:2100498</code> 签名的例子中，classtype 是<code>classtype:bad-unknown;</code></p>
<p>alert ip any any -&gt; any any (msg:”GPL ATTACK_RESPONSE id check returned root”; content:”uid&#x3D;0|28|root|29|”; <strong>classtype:bad-unknown;</strong> sid:2100498; rev:7; metadata:created_at 2010_09_23, updated_at 2010_09_23;)</p>
<p>签名的隐含优先级是2，因为这是在<code>/etc/suricata/classification.config</code>中分配给 **bad-unknown classtype **的值。如果你想覆盖一个 classtype 的默认优先级，你可以在签名中添加一个<code>priority:n</code>选项，其中n是一个从1到255的值。</p>
<h5 id="关键字-target"><a href="#关键字-target" class="headerlink" title="关键字 target"></a>关键字<code> target</code></h5><p>Suricata签名中另一个有用的选项是<strong>target目标选项</strong>。它可以被设置为两个值之一：<strong>src_ip</strong>和<strong>dest_ip</strong>。这个选项的目的是<strong>为了在Suricata的警报日志中正确识别源主机和目标主机</strong>。</p>
<p>例如，本教程前面的SSH签名可以用target:dest_ip;选项来加强：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert ssh any any -&gt; <span class="number">203.0</span>.<span class="number">113.0</span>/<span class="number">24</span> <span class="number">2022</span> (msg:<span class="string">&quot;SSH TRAFFIC on non-SSH port&quot;</span>; target:dest_ip; sid:<span class="number">1000000</span>; rev:<span class="number">3</span>;)</span><br></pre></td></tr></table></figure>

<p>这个例子使用dest_ip是因为这个规则被设计为<strong>检查进入我们的例子网络的SSH流量</strong>，所以它是目标。在规则中添加目标选项将导致在 **eve.json **日志条目的alert部分出现以下额外字段：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">. . .</span><br><span class="line">  <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">35272</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;203.0.113.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2022</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">. . .</span><br></pre></td></tr></table></figure>

<p>有了Suricata日志中的这些条目，它们可以被发送到安全信息和事件管理（SIEM）工具中，以便更容易地搜索可能来自普通主机的警报，或针对网络上特定目标的攻击。</p>
<h3 id="常见的规则"><a href="#常见的规则" class="headerlink" title="常见的规则"></a>常见的规则</h3><p>Suricata常见规则分类可以分为以下几类：</p>
<p>基础规则（Base rules）：包括协议分析、流量检测、服务识别等基本的规则。<br>恶意软件规则（Malware rules）：主要是检测恶意软件、恶意代码的规则。<br>漏洞规则（Vulnerability rules）：主要是检测系统或软件存在的漏洞。<br>检测规则（Detection rules）：主要是根据攻击的特征来检测是否存在安全威胁，如检测SQL注入、XSS等攻击。<br>告警规则（Alert rules）：主要是根据攻击行为发现安全事件并进行告警。<br>检测规则（Thresholding rules）：主要是基于一定的时间窗口来判断是否存在攻击。<br>收集规则（Collection rules）：主要是用于收集网络信息，如收集DNS信息、HTTP信息等。<br>文件规则（File inspection rules）：主要是用于检测文件的特征，如文件名、文件类型、文<br>件大小等。<br>协议规则（Protocol rules）：主要是用于检测协议的使用情况，如检测FTP、SMTP、DNS等<br>协议的使用情况。<br>以上分类并不是严格的划分，不同的规则可能会包含多种不同的分类。</p>
<h3 id="编写suricata规则的技巧"><a href="#编写suricata规则的技巧" class="headerlink" title="编写suricata规则的技巧"></a>编写suricata规则的技巧</h3><h4 id="针对漏洞，而不要漏洞利用"><a href="#针对漏洞，而不要漏洞利用" class="headerlink" title="针对漏洞，而不要漏洞利用"></a>针对漏洞，而不要漏洞利用</h4><p>避免编写检测特定漏洞工具包的规则，因为同样的漏洞有无数个漏洞，而且我们可以肯定，在你读到这篇文章的时候，新的漏洞正在被编写。例如，许多早期检测缓冲区超限攻击的签名是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert tcp <span class="variable">$EXTERNAL_NET</span> any -&gt; <span class="variable">$HOME_NET</span> 80 (content:<span class="string">&quot;AAAAAAAAAAAAAA&quot;</span>, msg:<span class="string">&quot;Buffer overrun detected.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>其原因当然是为了成功地发起缓冲区超限攻击，攻击者需要填充某个变量的缓冲区，并在最后添加他的恶意有效载荷，使其成为可执行文件。他选择用来填充缓冲区的字符是完全不重要的，事实上，在这种签名出现后，许多攻击工具箱只是用不同的字母来填充缓冲区，完全逃避了这种签名检测。一个更好的方法是试图通过检测基于字段类型和长度的不正确输入来检测这类攻击。</p>
<h3 id="示例规则分析2"><a href="#示例规则分析2" class="headerlink" title="示例规则分析2"></a>示例规则分析2</h3><p>有如下规则，下面对其进行解释</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert tcp <span class="variable">$EXTERNAL_NET</span> any -&gt; 10.200.0.0/24 80 (msg:<span class="string">&quot;WEB-IIS CodeRed v2 root.exe access&quot;</span>; flow:to_server,established; uricontent:<span class="string">&quot;/root.exe&quot;</span>; nocase; classtype:web application-attack; reference:url,www.cert.org/advisories/CA-2001 19.html; sid:1255; rev:7;)</span><br></pre></td></tr></table></figure>

<p><strong>alert</strong>：告诉Suricata将此行为作为警报报告（在为STA创建的规则中是强制性的）。</p>
<p><strong>tcp</strong>: 表示此规则只适用于TCP的流量。</p>
<p><strong>$EXTERNAL_NET</strong>：这是在Suricata中定义的一个变量。</p>
<p>默认情况下，变量HOME_NET被定义为这些范围内的任何IP：192.168.0.0&#x2F;16,10.0.0.0&#x2F;8,172.16.0.0&#x2F;12，而EXTERNAL_NET则定义为这些范围之外的任何IP。</p>
<p>你可以通过指定单个IP如10.200.0.0、IP CIDR范围如192.168.0.0&#x2F;16或IP列表如[192.168.0.0&#x2F;16,10.0.0.8]来指定IP地址。请注意，列表中的空格是不允许的。</p>
<p><strong>any</strong>：在这种情况下，它意味着 “来自任何源端口”，然后有一个箭头’<strong>-&gt;</strong>‘，意味着 “连接到”（没有’&lt;-‘操作符，但你可以简单地翻转操作符周围的参数。你可以使用’&lt;&gt;’操作符来表示连接方向与此规则无关），然后是一个IP范围，表示目标IP地址，然后是端口。你可以用冒号来表示一个端口范围，比如0:1024表示0-1024。在圆括号中，有一些指令用于设置警报信息、关于规则的元数据，以及额外的检查。</p>
<p><strong>msg</strong>: 是一个指令，它简单地设置了在检测到匹配流量的情况下将发送的信息（在STA情况下发送到Coralogix）。</p>
<p><strong>flow</strong>: 是一个指令，表示我们即将定义为签名的内容是否需要出现在与服务器（”to_server”）或与客户（”to_client”）的通信中。这可能非常有用，例如，如果我们想检测服务器的响应，该项可表明它已被攻破。</p>
<p><strong>established</strong>: 是一个指令，它将导致Suricata限制其搜索匹配此签名的数据包，<strong>只搜索属于已建立连接的数据包</strong>。这对于尽量减少Suricata的负载是很有用的。</p>
<p><strong>uricontent</strong>: 是一个指令，指示Suricata<strong>在规范化的HTTP URI内容中寻找某个文本</strong>。在这个例子中，我们要寻找的url正是”&#x2F;root.exe “这样的文本。</p>
<p><strong>nocase</strong>：是一个指令，表示我们希望Suricata<strong>进行不区分大小写的搜索</strong>。</p>
<p><strong>classtype</strong>：是一个指令，它是一个元数据属性，<strong>表明该规则检测的活动类型</strong>。</p>
<p><strong>reference</strong>：是一个指令，是一个元数据属性，<strong>链接到另一个系统以获取更多信息</strong>。在我们的例子中，值url,<a target="_blank" rel="noopener" href="https://..../">https:&#x2F;&#x2F;….</a>链接到互联网上的一个URL。</p>
<p><strong>sid</strong>: 是一个指令，是一个元数据属性，表示签名的ID。如果你正在创建你自己的签名（即使你只是替换一个内置的规则），请使用一个高于9,000,000的值，以防止与另一个预先存在的规则发生碰撞。</p>
<p><strong>rev</strong>: 是一个指令，表示规则的版本。</p>
<h2 id="suricata使用方法"><a href="#suricata使用方法" class="headerlink" title="suricata使用方法"></a>suricata使用方法</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://c0ke.top">C0KE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://c0ke.top/2025/07/15/YARA%20&amp;%20Suricata%20%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%A7%84%E5%88%99/">http://c0ke.top/2025/07/15/YARA%20&amp;%20Suricata%20%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%A7%84%E5%88%99/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://c0ke.top" target="_blank">Daily Study</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/15/zsh%E6%8A%A5%E9%94%99/" title="zsh报错"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">zsh报错</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/15/YAML%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" title="YAML入门教程"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E7%99%BD%E5%A4%A9.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">YAML入门教程</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">C0KE</div><div class="author-info__description">C0KE's Study Diary</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">404</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/C0KE"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/C0KE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/weixin_62675330?spm=1000.2115.3001.5343" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="mailto:2269279877@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人人都有选择如何活着的权力</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#YARA-Suricata-%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%A7%84%E5%88%99"><span class="toc-number">1.</span> <span class="toc-text">YARA &amp; Suricata 入侵检测规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#YARA%E8%A7%84%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">YARA规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Yara-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">Yara 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Yara-%E8%A7%84%E5%88%99%E7%BC%96%E5%86%99"><span class="toc-number">1.1.2.</span> <span class="toc-text">Yara 规则编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Strings"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Strings</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HEX"><span class="toc-number">1.1.2.1.1.</span> <span class="toc-text">HEX</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Text-strings"><span class="toc-number">1.1.2.1.2.</span> <span class="toc-text">Text strings</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.1.2.1.3.</span> <span class="toc-text">正则表达式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Conditions"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">Conditions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Counting-strings"><span class="toc-number">1.1.2.2.1.</span> <span class="toc-text">Counting strings</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#String-offset-or-Virtual-address"><span class="toc-number">1.1.2.2.2.</span> <span class="toc-text">String offset or Virtual address</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#File-Size"><span class="toc-number">1.1.2.2.3.</span> <span class="toc-text">File Size</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Executable-entry-point"><span class="toc-number">1.1.2.2.4.</span> <span class="toc-text">Executable entry point</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%81%8F%E7%A7%BB%E5%A4%84%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AE%BF%E9%97%AE%E5%88%A4%E6%96%AD"><span class="toc-number">1.1.2.2.5.</span> <span class="toc-text">对于偏移处数据的访问判断</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%9B%86"><span class="toc-number">1.1.2.2.6.</span> <span class="toc-text">字符串集</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E5%A4%9A%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BA%94%E7%94%A8%E7%9B%B8%E5%90%8C%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.1.2.2.7.</span> <span class="toc-text">对多个字符串应用相同的条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">1.1.2.2.8.</span> <span class="toc-text">迭代字符串出现的次数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#More-rules"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">More rules</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Global-rules"><span class="toc-number">1.1.2.3.1.</span> <span class="toc-text">Global rules</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Tag"><span class="toc-number">1.1.2.3.2.</span> <span class="toc-text">Tag</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Other-Modules"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">Other Modules</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PE"><span class="toc-number">1.1.2.4.1.</span> <span class="toc-text">PE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ELF"><span class="toc-number">1.1.2.4.2.</span> <span class="toc-text">ELF</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hash"><span class="toc-number">1.1.2.4.3.</span> <span class="toc-text">Hash</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Suricata%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">Suricata规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#suricata%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">suricata简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E5%92%8C%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">特点和功能：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suricata%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.3.</span> <span class="toc-text">suricata安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E7%9A%84%E6%9E%84%E6%88%90"><span class="toc-number">1.2.4.</span> <span class="toc-text">规则的构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E8%A7%84%E5%88%99%E5%88%86%E6%9E%901"><span class="toc-number">1.2.5.</span> <span class="toc-text">示例规则分析1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Actions"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">Actions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Headers"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">Headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OPTIONS"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">OPTIONS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%9AContent"><span class="toc-number">1.2.5.3.1.</span> <span class="toc-text">关键字：Content</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97msg"><span class="toc-number">1.2.5.3.2.</span> <span class="toc-text">关键字msg</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-sid-%E5%92%8C-rev"><span class="toc-number">1.2.5.3.3.</span> <span class="toc-text">关键字 sid 和 rev</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97reference"><span class="toc-number">1.2.5.3.4.</span> <span class="toc-text">关键字reference</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97classtype"><span class="toc-number">1.2.5.3.5.</span> <span class="toc-text">关键字classtype</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-target"><span class="toc-number">1.2.5.3.6.</span> <span class="toc-text">关键字 target</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.2.6.</span> <span class="toc-text">常见的规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99suricata%E8%A7%84%E5%88%99%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.7.</span> <span class="toc-text">编写suricata规则的技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E6%BC%8F%E6%B4%9E%EF%BC%8C%E8%80%8C%E4%B8%8D%E8%A6%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">针对漏洞，而不要漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E8%A7%84%E5%88%99%E5%88%86%E6%9E%902"><span class="toc-number">1.2.8.</span> <span class="toc-text">示例规则分析2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#suricata%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">suricata使用方法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/Tenda-FH1201%E5%A4%9A%E5%A4%84%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0/" title="Tenda-FH1201多处命令注入漏洞分析和复现"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Tenda-FH1201多处命令注入漏洞分析和复现"/></a><div class="content"><a class="title" href="/2025/07/30/Tenda-FH1201%E5%A4%9A%E5%A4%84%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%A4%8D%E7%8E%B0/" title="Tenda-FH1201多处命令注入漏洞分析和复现">Tenda-FH1201多处命令注入漏洞分析和复现</a><time datetime="2025-07-30T03:04:06.916Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/GL-iNet%20%E8%B7%AF%E7%94%B1%E5%99%A8%20CVE-2024-39226%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="GL-iNet 路由器 CVE-2024-39226 漏洞分析"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GL-iNet 路由器 CVE-2024-39226 漏洞分析"/></a><div class="content"><a class="title" href="/2025/07/30/GL-iNet%20%E8%B7%AF%E7%94%B1%E5%99%A8%20CVE-2024-39226%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="GL-iNet 路由器 CVE-2024-39226 漏洞分析">GL-iNet 路由器 CVE-2024-39226 漏洞分析</a><time datetime="2025-07-30T03:04:06.914Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/%E5%90%AF%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E7%8E%AF%E5%A2%83/" title="启动路由器环境"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="启动路由器环境"/></a><div class="content"><a class="title" href="/2025/07/30/%E5%90%AF%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E7%8E%AF%E5%A2%83/" title="启动路由器环境">启动路由器环境</a><time datetime="2025-07-30T03:04:06.907Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/%E4%BF%AE%E5%A4%8D%E8%B7%AF%E7%94%B1%E5%99%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83+%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/" title="修复路由器程序运行环境+远程调试"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="修复路由器程序运行环境+远程调试"/></a><div class="content"><a class="title" href="/2025/07/30/%E4%BF%AE%E5%A4%8D%E8%B7%AF%E7%94%B1%E5%99%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83+%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/" title="修复路由器程序运行环境+远程调试">修复路由器程序运行环境+远程调试</a><time datetime="2025-07-30T03:04:06.906Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/30/ikuai-3.7.10%E7%89%88%E6%9C%AC%E4%BB%A5%E4%B8%8B%E6%9C%89%E6%8E%88%E6%9D%83%E7%9A%84cmd%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/" title="ikuai-3.7.10版本以下有授权的cmd执行复现"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ikuai-3.7.10版本以下有授权的cmd执行复现"/></a><div class="content"><a class="title" href="/2025/07/30/ikuai-3.7.10%E7%89%88%E6%9C%AC%E4%BB%A5%E4%B8%8B%E6%9C%89%E6%8E%88%E6%9D%83%E7%9A%84cmd%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/" title="ikuai-3.7.10版本以下有授权的cmd执行复现">ikuai-3.7.10版本以下有授权的cmd执行复现</a><time datetime="2025-07-30T03:04:06.904Z" title="发表于 2025-07-30 11:04:06">2025-07-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By C0KE</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="C0KE,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>